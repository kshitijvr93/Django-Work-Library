20170424 monday sobekcm code camp
t0820 start

Had less coding before.. and now pure code camp...

Mark provided a new item viewer jpeg plugin that we now use at uf..
and now we have a plugin.. and
richard bernardy has been using plugins since december 2016
rb is exploiting the html viewer.. and all thetext fields.. in some records that broke articles to pdfs, i jus tused the downloads iewer, and I usd the html viewer for other
and if we culd add order values to download vierer it would be good

mvs - you just added the viewer
rb - no that was my last viewer.. it seems to be the alst pdf in the struct map
msv it should have a order, we can do that and make another demo viewer that acknowledges the order
mvs so ht html tags hothers ahve erquested and we have another ticket from london to put in a carriage return tab..
and so we need a solution to talk about mroe maybe ehre
rb and here another

rb but another thing we can think of is usig the wiki context stuff, like
** becomes double-bulleted.. or we could choose html slashes vs wiki style editing.. and github does it.. and wikipedia does it..
it seems slightly more accesible for other md entry users
rb the other big thing is limited nature of the resource type fropdown
mvs itis only r list for upcoming
rb overall i need to do more work.. well i do local customizations in js, and other big one.. is .. updating iface fro validationafor html5 validation
and mvs we want to be html5 valid, but if we are not, please chane the core code and fix and resubmit
rb - i had a demo that was mobile iface., started, and director of mktg kiled that
and responsive design regular html i ahe not gotten to yet
mvs is html 5 invalid
rb I used, I amd switchign to chrome but use firefox now and I use alidation all the time and there are tons of woarnings and error wrt responsiveness tags
mvs - the responsive thing is another topic we want to addres.
mvs my feeling is this sie is image driven, and there are mny options you can do..
it is not like take my corp website and maek ti responsive
and have been working on making the web aldo a mobile sie.. maybe with new webskins and simpler features.. and if youw ant to do it.. and you can do it as a plugin..
and when at menhu.. iteim or collection level you can cr a new iewer and offer as a new pluin,..
rb i wil have to, and ai work with another entity and launch deadline is first day of fall classes, and i ened mroe guidance, and i realied it could be done in tnew top level directory so we can presever our digital url
and
mvs and admin pages i have no itnetnion of changing...
mvs and wrt better support for other langs, i do not intend to offer for admin pages.. too many
rb has a coupe of examples to discuss..
mvs - and good exmaples.. and item viewer you shoul can make look like dml? or etc. nad we will talk about item layout mroe
and the enw strucutre will use the item layout model for collections, and you can also use that for collections, for config, viewers or layout template, and the newe verison out there i beilive ahs the layout as well.
-
patrick projects - nothing special except looking at some errors and stuff that they thnik it sould be and we are doing retoolig of backend pieces that doe bulk stuff.
and mvs wants to sit down with us, as the new stuff, and t
patrick and the lem serer, and jacskon is rewritin soem ndnp stuff..
jackson- there was. aissue, 4.10 had to include new librarires and the conencton stirng hadlin in ndpn and open and save of mets also changed in 4.10 so all had to be updated.
ands wwhen ne bib,s a new call has to be made.. j
mvs and you can define workflows of image cleanu with lem server,..and it is eas to apply too much cleanup and laod to an ftp server.
mvs - and can meet with mark along with chelsea, and fiu also uses it... ie the lem stuff tmvs saw the guy who is diong images work
and there is a gigantic list --
rbb we ot a new copy book to replace our boren one tand hey wanted to sell us a lot fo software
ms -and with lem stuff you wont need to use the dlc toolbox, and it uses, changes the sindows app the qc tool they hae een usin forever..
and patrick
ps she does use both the web version and edesktop ersion  - jane penn--  s - it would be good to know why she si not using the web completely
alls the dlc toolbo did was build image deivs whcih buildr now does and lem will do, and does soem qc and ftps it up to the server, but now can only drafg and drop to the folde..
and we can drop support with the toolbox.
jl stuff
he has beenworking on nonseobken elated and our tivoli has been actin up
mvs do you pay fro tivoli
jl we do pay for it and is more expensive that google cloud
mvs - we charge by sie of repos to our customers, but we do not keep their masger tiffs, and we consider a sobek integrated archival ssystem .. that loks at glacier, microsoft,
rb is begging for glacier, most felexible and shceaper, and ok to wait 6 hours then it is fine
mvs will shae wht he is looing at
and
jl they do not like to wait mroe than 30 seconds..
jl - google cloud has retrievals..
-
t0841
- mvs for us we wantd to spread it across ultipel vendor.. i have nto pricedd google cloud itn a while.. but bit.
and paul
is with sobek digital and aoperations.. and ethe archving thening they look at, and beten strating to look work with per metrics and sobek cm in the cloud
and paul sullivan is on amaon.. psul..
mvs and a good oppty ..
mvs has been developing uf for 10 or 12 years, orig for dloc project and another we started sobek, for historical societies to submit materials...
then we open sourced in 6 years ago and I left UF to be able to market the software.. andwe have een around for about 3 years.. and supporint storage
ud using oreo libray is using sobek and wanted mvs to host it
and we have beenw riting as open source, and trying to drive to 5.0
and mvs is seeing light at end of utnnell
and 5.0 is gib next step
and soem blugins will be open sourced and some subscription based
and we will have an app store to register plugins..
-
mvs the alst switch ... per the roadmap, we hav to reindex every item in repo, so we do that in verison 5.0
we have had problems with our solr service  host stopping responding... so why not support old solr and new solr simulatatneosusly.. we can run 3.6 and 6.0 is now out so in 6.0 can connect to it and it will connect as a sql complient db, and can do some nice selects, so less of a black box
mvs continuing..
can look at all data indexed on it, and we may switch to it and have option to go the nwer solr soon, but not nec md searching at first,and problably 4 months out, as with 5.0..
rb so ththey wanted full text search as default, and not all items have full text.. and that has proved popular..
and so one professor i mentioned i cannot convince.. the name of the collection is crom, and one itm has 'crom' in the full text that is not related to his collection, and he thingks something i wrong, but no, but a challenge to explain to professors

rb and I returned to the prof a forensic analysis of search results
and stil not satisfied..
--
mvs I was thinking about newpapers and helpful to look fo r'gaiensville sun" together
mvs and I want to be able to collaspe enwpapers into titles..
mvs and search for gainesvill sun... can get you into tons and tons of issues... maybe a problem?
and we use full text indexing on the sql is how we do full text indesing, and problems a is have to choose languaged for the dict and b identifiers with peridos are splitted and it causes failures, so we need speical code for identifier search
--
and now we look at our schedule... and we will talk fo ra hsort bit and give a chance to work on it.
and helpful to show some ot ehe work wwe have done to show what we have done, or the group.
and mvs has proposed som thingss...with the schedule.
t0903 -
mvs - the litltem fda xml files are now downloadable - an issue to fix. so maybe we should be able to add a sobek... xml file of different type.
--
rb new types of content like rti is jpegs and xml files and the 3d models and texture files are..
mvs - if oen wanted to use viewer to maek a thousand jpeg slices.
--
mvs we switch the sceduel a it
today we will cover add new gneign endpoint
and we add in bulk uploading.. and we can propose anyting else..
-
topic new engien endpoint
so think of soemethign you want to handle
coud include an entirely new structure to ssokekcms databbase like a new ead viwer with awhole other structure, showing how ontianers link, and you wnat to upullthat strucure out for another external system
and think of a report you might want to use
so if you writ a reporting thing it is simple to tie into html or serve item info a differetn way..

and we will add a new endpoint to add a results viewer in a different format
so lets think about that..
the endpoint topic is at 2:15 today that is..
Now topic is git basics..
example repo: https://github.com/SobekDigital/HolaCampistas
so github.. is .. all topics today are same for github or gitlab
or sach, not svn though.

mvs likes to use git app separately.. and he usu closes visual studio and launches exernailly
intalling gitextensio is fyou wna tit:
downlaod installer: https://gitextensions.github.io
-
-mvs we do not have anytying wathiching the cod now,
i am looking itno an auto comipile when a coe is comittd.. so i want o reject commits that do not compile using jenkins or hudson.. but team foundation is expensive
so iwhen I get the code woring for jenkins or hudson... or it is travis has feremiu  minor editions..
- freemium
jl - travis is nice too
- jl they also - can pay $70/month for their code..
t
- today we do hands on to pull down repo and make changes,
t1040
fedoria is one of largest open source projects, but for now only 5 of us here, and he may delegate authority to approve pull equests to one of us...
rb: one plugins came out, it i safer now.. for us to work with
and so now the pace of the sobek changes have slowed down in last month or so
mvs
and in genrql velociy of changes will slow because we make ore things configurtion and plugin driven.. and for exampels changing base functionality will e rarer neeed

So please do merge and submit any code you do..

msv - So we will talk about results viewer here .. but if we did
make changes and wanted to add soem functionality..
and msv says for rb one example is timeline..
and we talked about harvesting.. ..

-- and mvs says there are some things like generic harvesting sources..
are good candidates to add to base code.
and we will still have some cases to push code (after plugins are widespread).
and it helps perceived life of the project if more committers..
and over time if we get more contributors we will add pull requests

and mvs knows of 2 companies adding to code,
1) one is the universtiy of london
2) and another group with more localization strings to support,
about 14 asiatic languages, and that would be only a configuration file...
- --
submit often and submit a lot is msv invitation

rb: says he needs to learn the cpt variable name, the inserts or the 'directives'
mvs yes we call them diretives, where we insert version numer or id
mvs I have considered a way to make that extensible to create your own
small chunk of code...

so we are talking now, next topic is on the road to version 5 from t1045 to t1130
We will talk thru the changes.. and we will talk about plugin later from 1130-1230
version 5 idea is more api driven architecture, less monolithic code
and we are 2 years into this change
and it was well organized into enumerations nicely mentally
diveded it was,  but harder to pull into many libraries
Now we are pushing enumeratios into configurations files for easier changes
and another major part is to expose data through the config files
so we can understand what code is doing, how configured...

mvs continues
now looking at settings/sytem-wide settings
and we have a new collection wizard
but system-wide settings is newly organized..
and it is most 90% now in config files and 10% in database, and
the item viewers are in th db per item..
so need some db data on viewers.
and diff info on md? is in config files
and new way to create own item viewers is here now too
and go to sobekrepository.org and left margin go to
technicahelp/development/future...
that section of page links is now lately maintained.. see text there..
now it shows version 4.11  list, today.

So biggest change, there now is finishing the item viewer architecture
changes.. where you create your own layout and viewer plug into
the layout.. and this will come out quite soon, much already on
github daily version

and item mgmt changes item will be in next version,  but this
version has all architecture changes, version 4.11 that is..
and we add more system wide editable settings.., adding usage
email eg to system wide settings

and this is first one ..

jl - was an issue with the template themselves not includig  the
email address on them,
jl so we should look at our templates
mvs yes - and I will look at that with you...
yes, another major change.. is now.. under config/user, and also
under many places we have added user folders and default folders.

So now see mySobek/tmplates/default is there.. the default templates
had removed the email addresses

So if make a dlocxml and .. so it will look in default first and
then look in mySobek/templates/user

so the same now with config files, and we should not update the default ..

I can make a user folder that will be honoroed to hold the
configuration of item viewers.

-- and we also .. now the
mvs: re the usage email info
and two more are not now schedulable, but if builder just start
there are a few that are doe..
but we will add scheduling.. and in future builder will run as a service
and get fired up but in future it will be a service
So now it turns itself off at 11pm and back on at 4am...
but it will soon be a true windows service, so there will not a
startup... really, so it will hadle schedulable tasks..
so it will become scheduled tasks, in the db, and we work on
finishing web gui to set them ..

now looking at version 4.12.
and we are doing more item mgmt stuff,
and the time beh screen will change and the templates
and now you just assign little elts in the template files, for
also editing md and editing behaviors
and it will change.. and can say create a whole item template page
and the thumbail will be its own whole item page
and we added a lot of possibility for item viewers

For inividual items you can change order of the viewers, eg for
aerials.. to show the map instead of the first jpeg..
So for individual item you may want the google map to be the
first view or you may want it to say tiles instead of map.. and so now you
can label your viewers, and it will become available via the user iface..

mvs does not like to tie anything to agggregtions, but items can
be in multiple aggregations and it becomes a free-for-all..

mvs - and also in v 5.0 is idea of projects - and you would tie
diff info to the project like viewers
or you can say an item goes into a project to inherit default
behaviors (as we can already inherit defaut md)..
--

and usu, usually,  we will add new functionality with plugins and it gives us
more power ourselves,, and basic architectural changes will slow down
and the goal is to not make changes to base code as often
t1102
mvs maybe some v4.12 features will come out sooner, ie
the system wide settings
and v 4.12 item 3 - add bulk spreadsheet and marc importer to the
web interface -- mark is going to support soon..
and may make a way to save their mappings, and it will be sent
to builder to do the importing..
mvs So that is a gigantic piece -
we purchased a new company last year with 8 or 9 new customers who
need these bulk speadsheet features..
--
and we will look at item viewer and widgets
and version 4.13 is just the collections stuff.. meaning you can
do what you wan twith collection home page, and each collection
may have multiple collection viewers..

-rb: one staffer jsut updates the text but we want to prevent hstaffer from updating other stuff... for safety... to have more granular editing rights..
mvs yes we should think of that
mvs also is idea of viewing rights on diff collection viewers..
mvs maybe the same way item (editing) permissions, also the viewers will work...
will be similar to item viewer
and version 5.0 will move all searching into new Solr indexes and
make builder run as windows service.

rb: other db support? (rb/USF uses MySQL)
mvs; we added construct to ask what is the db type and then
a gateway to get to it and a layer that gets to that, but no
coding yet to get to the db..

and postgres is a priority after 5.0..
we were looking for postgres but rb is working on mstyql
rb: a colleague must look for failover and disaster recovery..
rb: our gis people are able to go to the cloud for backup, so why not us
mvs - you could, most expensive will be web-accessible files...
mvs you can run ms sql on amazon cloud and azure cloud and .net
runs on amazon and azure too--
mvs biggest thing is just keeping it updated...
jl question: we are hitting the limit of how fast builder can
run on a single thread.. and we have 2 ways to approach.
and we look at .. logging issue
mvs - logging would not be too bad.. it puts in first log and it
gets back logid .. and all addl logs reference that logid..
and if you sort by logid it can be sorted..
and mvs has often said to run another builder...
but we have no
way to represent single vs multiple builder in the db..
--
t1115
all: builder may need some updates
mvs I was thinking ..for solr and could also work for bulder,
create an engine endpoint to give the health of solr (and maybe
another endpoint also for the builder)
and status cake would email us for a 404 on one url..
so the endpoint url would return 404, the status monitor url
for a specific service.. a shortcut status notice.
-mvs uses statuscake to check urls

- we have a new wolfsonion builder module.. they create a mets file and uses
their accession number
mvs and we worked on another builder module that extracts from the pdf and creates
the mets,  and creates the bibid with an id that it reserves
and the builder module is really powerful
mvs has been doing folder level builder modules he has been writing..
- mvs has a good feeling that when we load it out...
we will end up saying or they will that they want other md loaded as well..
- that is our current list of pending projects..
- rb: you have google map editor listed..?
and it is under additiona planned changes - originally written by laurie..
--
mvs - st aug grant was supposed to add user interface for adding
coordiates and that became funky I will try to add again..
and bullet 4 - sobekcm image server -- to draw a circle around say a
stadium on a tile., and we will eventually use also to hightlight
the text version as well.

adding lat long was most complex, and then adding rectangles,
and each aerial has many tiles or pages and each is a geo book or
tile/rectangle, one assigned per page.

and we can add other stuff later.
.
the EAD support big part was first getting engine working as much of what
we serve is static html, and what is generated by the app is what is seen,
but the idea of ead is compressed container lists and they can
drill down, and with ajax node expansion it will say just give me
newest what is in this container.. we will work on this , and we
will charge non-hosting custs, and john nemmers helped a lot, so
uf will get it free.
-
and other ones we will get is better support for authority contril..
we are looking and also mvs and I should just say digital comons
what is pushed over 2 year is a map of america or world that
shows where your hits are coming from - digital commons loves that per rb
rb we plan ahead for the md thing by expanding author field and
putting the id number..
mvs some things we will baby step toward -
at first we will just support open id, just a small amount
and re prepping for new versions - it will take a while to reindex
your items again..
we will give a small thing that only does a solr, it is a point of
no return, it runs through all your text and runs solr
so next time you have an item with 500 text files, the next time you need
not resubmit all 500 items for solr indexing.
and mvs will give us tools that do just that..
it is big bec it has a point of no return (Q: ask about this concept0
and puttinng stats on the map will blow up our db because each stat will need a per-country breakout number then.
bec now we have small info in the db, we have a single line
saying this item was hit with soem ffiew options per month, and
that will explode by N of countries that hit it.. it iwill be
interesting, but maybe too costly to keep
and digital commons keeps all hits from non spyders.. a lot..
t1126
and mvs wants to see how rb will prepare for the new version
rb our catalogger works with a traditional catalogger who has done
a poster projec wity european data model and will next do a full
conference session on it
mvs - so the way we will handle them is jsut another table in the
db for all your authorities
mvs i tend to think of people and places but also authorities exist
for subject keywrods
so we have folder for each resource, and each authority will have
a folder, and at bottom is an EAC?, like an EAD, and life events
and marriages can go in there, a vast expanse of data, and there
will be links to other authority systems like wikipedia or neeco
and so each will have assigned authority id record linked to open id record
rb: and it deps on how open they are..
--------
new topic plugins and configurations
and we can see how much of a plugin is related to a configuration file..
and so we will look at configuration file and see where plugins are and
what all is editable in a plugin.
so now we open VS and dive through it..
looking at sobecm_item_viewers.config
now see web page for system-wide settings... on web interface..
-
now it will be dry.. and also on sobek repo page left side, go to
item plugins and tools.. smartool is at the bottom
but go to the top.. to see how to create a new metadata plugin,
a good source to look at other examples..
--
so the wolfsoniaon one is nice for builder..
and custom md is a long and intricate process..

rb and mvs we need a helper class

rb started a new one that needs many fields...
item viewer plugins exist, see links on this page for rti item
viewer, and 2 more and richard created.
and so if create a plugin..
also engine api endpoint plugins work..
will be some changes.. but until version 5 there may be more configuration..
and we had to change some tags when we dled the new jpeg viewer..
make your new viewer in if it is a plugin in a separate github repo
and they are injected with new config info plus dll
so we will look a new configuration information now we will run through
were to see online and the new config file
and also the new item viwer layout (it will be similar for collection viewers).
==44

so in configure folder,  sobemkcm/config/ have a user folder..
and it is nto choosingone other or other..
see system settings, reading log ato ses whole list of config
files that were read..
and must turn off iis and turn back on to get thsse config files re-read now..
--
so see config fields reading log
and see the output., so see it reads all infonconfig/fodler first,
and in alphabetical order, and then it reads all your plugins
subfolders (siblings to config, and then the config\user folder)
so the core idea is the concept..
do as much in plugins as posisble, so the config/usr config file
sobekgital_engie+ips.config file...
he might make a plugin if did it over again, but make almost all
you can into a plugin
the idea of config user is a way to mediate diffs bw plugins, so
we can stil use it like today
but in future maybe call it really a plugin
and in future may add a way to say whcih plugins would be read in
first so you can order them
and also the config user folder config files are a way to emdiate ..
so now looking at sobeckm aggregation_viewers.config see this file..
we did here, a way to inject code into the header see line 26 the
<htmlHeadWriters> and we needed this bec london needed to add the json info..
see digital.soas.ac.uk
they cr a new front end
clicking on discipline baio juan... no just scrolling, and they sort
of use a tile look instead of text.
now we see digital.soas.ac.u/d_bao
and the home page is here, and no home tst, and some collections
as here have menu item 'about' at far right
and the tiles are selectted server side, the first 14 or so
but with the config file here.. you can injust code in header at
collection level as json.. and your plugins shoul do this injection
so here can inject anything you want in the header...
almost all we have here now.. this is the default one, so it is safe
enough to say <Clearall /> (but not usually)
in code I might put basic aggreg ifo,, which is why you see clearAll a lot,
to make sure all in memory is cleared, or in an config file,
you can use this.. in version 4.11 or just today's latest github code
and see sobekcm_brief_item_mapping.config
and now in it the mets.. the mets is read by the engine and then mapped
into a brief item and sent to the web, which is used for all its
public interactions, so to mets item mapeper maps between the mets and
brief item
must map to briefitem to make web know about it..
and sobekcm citation config.. has diff citation ses so you can at least
select it from the behavior screen
and now see system wide settings .. under settings/... under ui
configuration/citaiton viwer.
here you see a list of each view..
and citation sets give the order?
so when a user sees a ciation this is the order of the metadata,
and the search code AU is used for creators and if AU appears it
says creator is linked.. so you dont have to search yourself..
and last column say customdisplay creator_SectionWriter),
you can say to create your own..
and so see for spatial coordinate under subjects spatial coverage row,
customdisplay(SpatialCoverage_SectionWriter) so you can overwrite
citation order of tags, etc..
rb: wrt temporal coverage, add support for items before common era (AD)
--
and see top level contact form, and individual contact form can
differ, this is sobekcm_contactform.config
so can overwrite with another config under the aggregation level.
-so this is (systemwide settings webpage) engine configuration/engine
server endpoints..
a read only list of engine endpoints, also gives the method that
is called in your code, and bottom? shows the class that is bing called..
--

see page content for component c9 and restrictions we see with R0 and R1..  with mOdify and Read Access attributes.
-
so in sobekcm item viewers, id="OG' allows to inject ogg, and when ..
including search engine root, they will get this item in the header,
and the OG is useful in the header a new one..
and see sobeckcm item viewers.config.. and go to sobekrespository,
no look at setting page see html viewers/subviewers and there will
be an item one shortly
so see these rows
this is a combo of what is in the db and the config file..
so if ienabled column is -, then it is not enabled, but see class
is not implemented..
and the db gives view order and menu order.. and config file says
who displays it and it vies the ui code you will use by default.
---
and default view colum checkbox/flag means that for a new item that
is created in a system, those views are addded.. and also when editing
an item they appear as viewer options to select or deselect
so the system now has every view attached to it that is possible to
show and now every item has a pdf viewer attached..
so every item with a pdf has a pdf viewer attached,
but the viwer will show only for the pdf item..
-
we do have a way to say always add this view..
and mvs has said that.. so would never be able to turn it ovver if
you check on that always add column.. but usually only used for mgmt views
and see for mgmtViwer="true" in the config sfile..
--
and if same mgmt order, they appear in same ddown together, but if
diff odrder, they appear diffeently.
now see lin... a new layout file refs a source file
under sobekcmhtml/itemviwer_default_layout.html
see it is like an old sobek file
and see [%section xxx%] syntax at top
and if compare that htl to ld version of ufdc, see the view
source.. you can see the tasmeestgart of a item is <section itemscript itemtype
so when item is first piplemetnd it reads its source file item
viewer default_layout.html,
you also have to restart web server,
so whenever add an item all this text is there....
so they have directives that define sections..
so could use this for three elsevier viewers to not have to change base
source code..

so see section L:top comes from our config file
sobekcm_item_viewers.config file.. it..
see there layout id="Default" source--..
and see under section writers
and section name top.. read by item viewer section writers.
and see about 5 or six show .. see ViewerNav_ItemSectionWriter..
and also line 43 shows [%section:POSTVIEWER %] , just not used
here, but if want to also show a bit of citation at the bottom,
you could create new item viwer method and tag it here... a new
plugin..
-
MVS a good eg is thumbnails, and if you wanted to show something
under the ...
then eg, to look like contentdm, to have small section at bottom,
either get rigd of citation entirely or use the poseiewer.. so
using this technique you can drastically change the way your item
viewer is written..
mvs - this is similar to what we will do with the collection viewer
--
now see config default sobekcm_mapeditor.config
an example - this is the mapeditor we will try to allow adding
coordinates... to get working in future
and see sobekcm_maetadata.config - just marching down the list of
files under config/default
this shows how to addd and read and write md and .microservices.config
this is only for the user iface , and we had sobekcm engine and we
have microservices that tells the web which endpoints to go to.
but we could run the engine on one webserver and ui on other server

and we could have our own services and not use [BASEURL] syntax
tubt overwrite to go to our own endpoint..
--
so this also shows you which endpoints we are actually using
so see first client get-complete-aggregation' you could write
your own service to return similar data to what the curernt url
returns

likewise if you create new custom code you may want to use this,
but rather for plugins usu not used, but can be (not used so far)

next topic is oaipmh.config
this is the harvesting protocol, and it now supports dublin core,
oa_dc and it has the Class, that writes it, and in a plugin you
could add another third line to serve oai or other in a different format..
and other viewers may not go away..
but we see file other_viewers.config
file qc.config, has existed a long time
it lists diff errors that would be available and can assign to diff people
and more importantly you can define new division types..
eg adverstising, plkicia data, and you can assign to diff users
working on diff projects, and can give a user a new profile to
limit their dd lists of their gui...
have been in dlc toolbox a long time.
And new results_viewers, config is added...
See here
these are the diff results viewers by default.. and it is easy
to add new ones and override one..
and you .. the system does expect to find a brief view and table view..
and it is easy to overrite existing or create new ones here, and
it includes the icon to disply in upper left corner..
-
but this is our own main results viewer..
and this is complete may not need another but may perhaps choose
another way to use item viewrs..
--
and see file static_resources_cdn config
and all the javascript is here, etc,
so here we have also resources_cdn(secure and local)config
so when go to sobekcm settings.. so go to demo site. and go to
general settings..no go to guid settings system/server settitnggs (from db)
and see static resources source (local cdn cdn secrue local, and
if drop in new config file the choice will appear in ths dd list..
so can edit to put the resource(s) to link to put on local, eg  if on a
plane without inet access and need to test develop sobekcm

but by switching to cdn, now our default, we hit a content deliv nw,
and it is faster for users not close to you your webserver, but
closer to a node on the cdn network.. so good.
Choice cdn secure is served https worlwide over cdn newrok a new one
and other file ...secure.config.. see served via cdn.sobekdigital.com
is https here, so if want to use https, switch to use cdn_secure
now last file is template_elements
here are. so here, see template and see online..
in marks mydemo in systemwide settings, under ui/template elements
under systemwide settings
so here is read only list of of fields you can have there
this report page also shows the actual ememment that is shown in the screen.
-
see gen settings under heading of emailsettings..
so if you have a pluging yourself.. you can add your own
settings and it could say myplugin settings could appear there...
mvs has not had a case.. so far to need it though
but you can use system wide settings for plugins..
now the cofnig file info under sttings/config/files
see this text.. it tells the order it reads these things..
and plugins would appear under config_viewers.config
so if enable a plugin, see this page to verify it found your new config file
and then can click on the option reading log and it will show where
it was found in sequence, and as it reads each one, it gives a bit of
info on each tree it is parsing..
-
so this is really what the engine read
so the engine ignores the microsrevices.config file, which is the
good reason why it does not announce it was parsing antying -
and this is actually ok for this one config file
all others would say one liner after the Reading.. line..
so this is helpful
and now seee see builder settings section/page..
and you can see those setttings.
-
and your incoming folders are listed
--
so see admin/builderfolder/1
you should be able to choose net version which builder module folder
set you will use,.. and so for now we will do some stuff in the db.
and see settings/builder/modules page
and see section pre-proces modules.. and it does pre processing,
item processing, post process module
and the md configuration section.. files readers writers..
we see breifly now more later
now to settins/engine/authntication...
at bottom .. shibboleth authentication: not naled here today..
but for uF we will see details..
and this whole page are always going to be read only, so we have to
edit config files for all this
and see brief item mapping on left
and see oai-pmh prototocol
see oai_dc and marcxml are enabled here..
and quality control tool is shown
and under ui configuration citation viewer....
and last see html snippets... these are top level html things like
the html snippets, the usage emails..
they now can be edited here, though, so now this section CAN be edited
via this web page
last section is the extensions, and it gives a list of extensions..
-and now click on admin/settings/extensions/1 (TEI)
so we want to say run some sql script when a plguin is enabled,
and add a new section after the plugin info with user-specified config info.
mvs - so if you store new md in the ..
and it must be mapped to the brief item..
the brief item goes to web and web must know it will be displayed
in the citation as well..
and must also be in templates if you want to edit it.
and another thing- editing templates onlie.. md used to be mroe fixed..
the intent is to be able to click on your tmplats and hae a ddlist to add certin md to th templat..
-
t1231
rb: tells his people that we can do customize md ..
t1232 off to lunch - on patio by the pools - Radisson at Cape Canaveral.
t
-
-customizing the appearance -
now collections - if in the demo instance on mmvs laptop
so now fo rmost accessible
for people in customized collections aan go to internal heder, manage admin view
admin/edit/aggr...
so see dloc and can say dloc/edit to edit content and edit eir ihome page of their collectionand create a slide viewer.. this is the key point of trying to provide data aout their collection..
so this ifce works well, not to sohisticated
can immed go into source view, but it does strip some tags, not sure why
so if h3 and inlnne style failes.. it might now work
but you can upload images well.. so can add a banner, edit width ad height, nice and put it anywhere within the text
so you only save this home page.
so different for home pages are anners and buttons on bottom under subollections. and the buttons will opoint lower but have a link back up
and can see admin/edigaggr/dloc/e on an edit page
and here can add hoeme page for dif langu and can add banners, new banners and then click a language from dd list for that banner -- if their bbrowser says this is their primary country of the web user...
--
based on their browser setting
and see now tab appearance..
and other chagnes.. you can assign it to a webbsckin (under another level lf mgmt)
and at botom it shows behavior active or appears oho hoeme page..
nwo see tab search.. so any colletion admin can choose a search segmen/style, etc..
and so a rqt for plugins and widgets is you will want a picture to show so thy cn aselect it
and see towrard bottom they can add map search and at botom..
but when adding plugins a challenge is hwo to support all this via plugins..

eg one ddlist opton.. fo rmap search default area... the default is 'zoom to ettent) ibecuas we have soem londong papers in this projet, so now you can select florida
and now can also do custom choice..but you can input your won zoom and lattitude and longituted.
-
-and now see tab results
to change or selet your facts on left
and tab metadata can set up md browsing.. and can add ssee dd list.. say add affiliation and difficulty, etc.. this is siemple for user to select
less simple tho is web skin chagnes..
we can update html headersffooters., css and javascript, and cn also to collection level css and javascript too, but still mroe complicated to omuch for a collection manager to expect to do.
so back to websckins - can crete a new webscin called railroads, sewe systema dmin appearance/webscins and make a new one called railroad collection web sckin and save it, an then view it.. and say edit railroad admin/editskin/wrailroad/c?n=railroad
snd ad see the soruce.. and the tab javascript is there ubut does not work to edit rpeextant js
so SHOULD be able to edit js, but it does allow first-time adding.. of js,
or in tabl css stylehseet you cn come update and add yoru wons styles at bottom.. and to call the js, you need to .. or can use jqeury to attch it to onrender, or thouht the webscin you cn use or include the js here,
so use webskin first if you want, and then look at editing infdividual olection
iujnder admin/edit/juv/e and webskins now has the choice railroad.
- so thse are th current webskins under which a cllection may appear, that is why youhave dupliate webscins allowed, settable.. so first one is selected if a collectio n with the x.. does not allow this.. it only comes into effect if you have webskins that are not isted in these webskins..
-t1:23
so see admin/portals.. and see url segment entry, say it has dloc.com in the url and see field portal name is dloc and system abbrev is dLoc and default webskin is uvides say
ad select dfrom dd list iuvi -added automatically
and chan change purl to be ufi.dloc.com
wo if a suer comes in and their url contains udlco.com, they go to that webskin on bottom of page of admin/portals..
so when time to cr webskin for an inivd request, it shcekcs the url progal/sgement and it selects their default webskin, and also in url could say ?skin=someskin, it should then use that webskin..
-this is a way to override
so everyghint is a portal, but it is whetehr it  is the defaut portal on that page
now to another page
at collection level, say to l/admin/editaggr/juv/e ie under appearance tab, you can cr a js under the collectionlevel here too under appearance
if you hit button enable and it creates a scustom tyleshee juv.css and you can edit that... so this is only for this one colection
 so here you add css, but this viwer could be better, to do css checing..
so this is a way not using the wbsckin ailty to do it at an individual colletion level.. at this ggregation-evel css.. but the js has not made this iface eyt, but  it is there
mvs prefers to do a websckin personally -
t1328
now 2 other ways to customize colletiosn
rb has most questions
lastly as we move toward this architecture, not there yet, but as with item laout, we will have a collection layout with collection widgents/plug-ins and injected javascript/jsquery
-
now see digital soas.ac/ud/arte page
see page source here, see the js at websckip level script/text/javascript.. he clicked to see it at ..design/skins/SOAS/sOAS.js
-
it uses jstree library - good
so this is a good eg of customizeing the site using the weskin js,
and here it expands the tree if it iexists
and if it is an aggregation type page...then we parse the hson in the aggregation_json (see html soruce) with type "application'json", so this jil? library is i n our sytstem by default
..and he sees facts, banners. and he sees views and searches and you see in this json in the html soruce, a buchn of chile pages, and see label About.. and so back to the js, it parses the object and see it looks at each chidlPages and if it is an bout, then it hadds an about to tha tmeu..
..oh, we also have a diff search than tha y have so wef hhafe fnTr.. some other funciton
so a good eg ouf usign js to do a good customization at the end where a...ac.uk/arte is really the aggreg menu
and the unchahing portions of the menu inclduees regions subejcts languages archives.. etc, and the thumbnails,e tc done mos tentirely by webskins..
mvs - i say if these tiel images exist it should be a homepage.. now it looks for a tile subflodler and if extant it will show this...
so we can see his copy of the agg page unde webroot/datesign/agregations/r)hg/images/TILES, a lot of jpg images.. so an admin can do this approach
-sothree ways to cusmize collections..
-
-
t1335 rb - lets see africanfossils.org
-- rb: this is a good eg dean/ has mentioned to me previously, nd if you click on the 3d models button, we see nicd pae.. and when you click on this.. bhtese are 3dmodels, rb:the q is can this all be done with skins and js and css..
or it is the conent page folder configu/custmomization otion..
mvs - he wuould shy away from static web content pages..
rb i would jus tuse it to iject a js app
mvs: i think you can so do this with a results viewer..
rb: but they dont like the banners...
mvs maybe need little changes to results html... and all this top part can be
done with a results viewer.. and the default css has width stmts that can
be overritten to pcts.. etc..
mvs can work with rb to help do this.
mvs - it depends..
--mvs - to do this right I would do custom md fo rsome of these like tool type or category type
rb has used the darwin core factes and put in canned searches, and the tools with site industry tooltype shows6 items would be factes like protobiface,core,biface,flkaed core,hammerstone,flake.
rb will ask mvs more individually
now back to collectiosn customaiztion
mvs one other thing here, and like the colelction ldevel css and javascript, you can slo create a custom html page that willbe read entirely instead of thedefault page
see -- just the ome page of the collection can be done like this - entirley independebt html with no idea of layout and no automaitc menu.. all is custom
and the back pages wrok fine.. eg you can put /all/ at the end of the collectio and it looks normal, but only thsi scustom collection home page is independently laid out, defined, see ..coleltion/html/home/text.html and that shows diretives bwith [%xx%] syntax
-t1345
now for items..
customizing items
method 1:
item changes - md updates, upload new files/images,
behavior updates -- any any anger of item should able to do this

-- customizing items method 2 -
web skin changes inlcude html headers/footers, css, js -

customizing items method 3
is more complete, as we now have this in place including;
item layout, udpate citation configuration and/or new citation set
and assign it to this item, create custom citation element writers
that wsas 3,
METHOD 4: and 4 new item viewers/pluggg-ins
METHOD 5: and  5 can inject javascript/jquery to look at item and do certain things
and then we can get in to robust item veiwer and citation writer infrastructure..
so those are collections and items, the 2 biggies in our lib

ALSO and other customizing
1)static resources configuration.. to use your ow css, eg, and general
plug-ins and config chagnes,
 and so this enables changes for most all customizations desired..
--
also see middlesexcc.sobeklibrary.com (maybe nj?)

t1348 - creating a new engine endpoint -
now to engine endpoints.. we go to systemwide settings and see engine
configuration on left, subitem engine server endpoints
and go to aggregations/all/json
and in url location just type localhost/engine/aggregations/alljson
(and protobuf and jsonp etc, xml are examples of formats)
so one thing to do was create a simple...
well...
mvs is talking with rb
now we look at th EDS one under richard bernardy github
a simple results endpoint..
we needed to have a config file..
sobekcm-plugin-endpoint-EDS
this is ultimately what the plugin folder is,  a config file and a dll
so his config file.. for the entire plugin..
here he has extension code="EbscoServices" and will add guides in the future
like version guid and plugin guid and has adin invo..
and most iportantly, see the <Assembly id - and the name=somemyplugin.dll"
is most important
and you only need to add assemblies with sobek code in them,
so if you have your own dll, in the same lib, your refs are now loaded.. so easier..
so this has not changed much.. we just have md about the plugin
then section Engine > has actual changes
so <Engine ClearAll="false"> and we define path segment plugisn, path segment
ebsco, and autodoc had for docs
and endpoints are there with method t seg Ebsco_Results_Json" prrotcol="JSON"
and similar line for segment = xml, component id=EBSCO_COMP,
method=EBSCO_Results_XML, protocol XML
-
mvs - actually 2 ways to show this, see his 2 endpoint tags, the verb is
not the, so default assumption is only "GET", so annot post to this one,
so a better way mvs will convey to allow get and post.. etc.
and the component ID appears again at bottom in section COMPONENTS.

now to another eg of this config vfile... would be.. mvs looks at his vs setup
under.. sobekcm/config/default/sobekcm_engine_co.donfig.
and see line 178 or so path segment with autotod endopoint
and now down to lines 362+ we see verbs
now skip down to lines 782 seee verb mapping tag there
in this case we have a path milestones'json, and that the tail of our
path (engine something/milestons/json
and this is more like a rest api as we can do either a get or a post
so here we add a milestone to a webcontent page..
so in this eg, you config like this to support more verbs than just GET

-now back to rb github repo
see pluginfo-folder-
and see subdir source and EbscoServices/EbscoServics.cs
and see the two methods.. with HttpResponse Respons, List UrlSeegments.. etc..
-
mvs: so to program plugsins, it is easiest to work within SobekCM
in the VS objects and maybe go within SobekCM_Engine_Libary/endpoints
and create new endpoints, call it a class, simpleEnedpoitn.cs

and we get our default using stmts and notice that it extends
EndpointBase, it is just a peer class Endpoints.EndpintBase you
can use, but not nec, but a helper class to give you basics
So here define public clsass SimpleEndpoints:EndpoindBase and put code there
and also in VS for sobek go for the config, go to sobekcm and go
to plugisn OR just add it into the confg/usrfolder as a sepa
config file, which we will do now.
so creating new file using windows explorer first..

So start with RB example plugin.. just grab his folder put it on
your webroot and under webroot/plugins and rename it simpleEndpoint
Services the folder,

and rename his Ebsco ..config file to ours and we can add any number of config
files or .config of xml files in this folder or any and all subfolders will be read..
a good eg is creating custom md, and if so, you might want a subfolder for each md.
may need a folder for the endpoint, and another for briefitem mapper, whatever
makes your code eaiser to manage, and just put in apt config files..

now we edit, our copied file we renamed simpleendpoint services.conf based
on rb changing name="Simple endpoint servies"  version="1.0",
add a description... change author names
and leave <permissions? as is
and <assembly .. we can add our dll name (anticipated dll after we make it,
but comment it out now)

now under engeine mapping/path say plugins and subpath simple and subpath2 is
also called simple
and request type is english saying it is get only
and under component change id to SIMPLE_COMP and change class..
and refer to them i the prior <Endoint tagg(s)... etc and
change the path now in the xml to plugins simple/results..
and now he jsut copied the code into his mouse and in vs now is creating
file under config /usr enw file templseimpleservicesconfigconfi
and now in vs is pasting in the text for oru new xml.
so we are creating this 'plugin code and config' in our entire web VS
project just for convenience, but when we get it working, we can
extract our two files, the dll and config and call that our plugin - nice.
-

so now we go unde sytem settings i cofnig, las titem and see it did find our new  file
and se wolook in the reading log and we see it found our new config.. fine.
t1412

and now loking at engine server endpoings..
so now at bttom iudne plbusins/simple are ouro 2 new endpoints.. and ti shows oure compoent info in theat componetbt table of the web page under ssytem wide settings for this ... these endpoints..
-
now we add our soruce code for the ethods..
we just used  endointbase to help us out as it has certain methods.. to tell sobek how to invoke it.. and to define the expected signatirue per web verb, etc.. some niceities..
-so see the method argumetns.. include url segemtns, etc, and request form provides get vs post verb type.. and the protocol was given in the config file to serve..
so nowwe go back to our config info.. and change class naem so SimpleJson
and define the method s by exact name we said in our config file,
and can just do a Response.Write("In Simple_results=_JSON_method"): and test it out , wthether it is getting there when url is beign visited..
and he goes out to add some usings.. using sytem.web, using system.collections.generic.. is all he needs to jsut those 2..
and now testing both the xml and json ..
also added the suign System.Collections.Specialized;

-
and adds usign sobckcmcore.cofnigureation.engine also
and system.web..
ok now compiles and tests the url..
so if he sets aggreagtaions /code/json/dloc/en?debug=debug.. it shows all the good trace info.. and n our code we must put a stmt to say if deug =true to shwo this trace..
very useful..
=
now engine/plugins/simple/results trying.. no endpoint, but add to end json.. but still not found..
so diagnosing the issue...
look at bottom of report fo engine endpoings..

now seeking in the report for simpleendpoings...
did have to make sure the config file was under the config/users
and the plumbing is done...
so now we make it DO soemthing that we want it to do besides saying I am in method x.

ok, now .ooking in restulsservices.cs for some stuff to copy over..
-
note DO extent class ResutlsServices (it is better than just extending endpointbase,but has more good stuff for results  helper methods) like enumerabtion info and ghe Get_Search_Statistics.. and so here we can use all the search ehlper stuff..
now at line 65 in resutlsservices.cs
mvs - so when you do a search it gets both things, the search stats tohat does not rally chane, it says te n of hits and the facets we will display -- will not change duirng listing 20 results..
-
so struggle 1 is objects are a bit complicated maybe a bit deep, and the second ocmplication is to make 2 calsl to see how many items are in the results and 2 is to get the results..
-
- so that is explanatinoof why we are doign this now..
so now we are implemetning something.. and tyring to implemetn what we want in our new little methdos Simple_Results_Json, and in here you can make antoehr db call, say you can do:
using System.Data
DataTable fromDb =new tabase.Engine_Databse.Builder_lgo_search.. whatever, intellisense gives a lot.. see could see builde rlogs or Get_All_USer_groups ro ge websckien
butfirs tline shoudl realy be Tracer localTrace = new(Custom_Tracer();
so now you have atracer (but do using SobekCM>tools) to use tracer):
-and now we have a trace and a DataTable.. now it is a LIst<User_Group>from d (and must do using SobekCM.Core.User
and next linejust say Serialize(fromDb, Response, protocol< string,Empty);
and in 3 lines you can create this enpdoing to cr tracer, get usergrups frmm db
and call serialize..
now test the url again lcoal/engine/pluins/simple/resutlts/json..
cool, iet works..
--
t1441
and now add lines
List <string? names = new List<string>()
foreach (user_group thsi user in fromDb)
names.ad (thisuser.name)
and serialize that and test the url
and now it works with ["everyone"], only one naem.. nice.
-So simple to do smal lendpoints
and searching is a bit mroe comples
and always serialze soemthinga s last call in the method to serve the endpoint..
so 2d line lshoudl have localTrace.Add_Trace("SimpleEndoings.SImple_Resutls_JSON"_;
so now when you use debug... so add code line
if (isDebug){rResponse.WriteLine({debu mode detected");... etc
or copy paste thsi...
Resposne.CoentntType = "text/plain:
response.write.. etc.. and get it .. the trace..
so this worked fine..
the if deugg and trace clause was asdded at the bottom, same thing if you detect an exception... show the info..
so every endpoint method has some code withthese snippets in there.
- very nice!
-mvs t1445 - so the debug portion is defined as anywone who puts debug=debug or maybe debug-true..
and so we may also add to debug an ip list of people who can sue debug.. bu now anyone can put this on the end. and se the trace..
-
new topic
now look at search retults example - rb's example..
--

--
20170425 tuesday start sobekcm code camp

t0830
now pulling latest sobek from github with changes mark made last
night:

pulled to my vbox machine UF-Win7 on my hp laptop..
-
got a usb key from mark, but downloaded it under my linux ubuntu
host in Downloads because my vbox usb reader is not setup...
-


now see the latest code downloaded and see file under So ekCM in
the webapplication and cd to directory Batch Files

and see file sobek_precompile.bat, and ark use the wix installer
that runs heap? to check
so if we run sobek_precompile.bat.. no first edit it
and change line to set source= to the curetrent path of the sobekcm-web-aplication
and set iis= to where ever you want to precompile to, soem tem directory..

now run it

and see where precompile you selected
and now go to precompile tmp (and it also has other subdirs?)
and next time it wil only update new/changed ones

and see the precompile outptut dir precompile/output/staging64 --
so under the second updated riectory - it is created there because
we did not change the precompile.bat file..


and see under staging64/config

it has a sobekcm.config template and some user folders, etc which should
be empty...

and this is what we essentially roll out to the web..

and so we really do not need to roll out mySobek all the time

and in this case the default  directory has not changed
and data folder not too useful to roll out either

and the folder config is usualy important
and mvs usually grabs only
 -- folders bin and config and all the files and copy it to the webroot,
and that is it

and even outside visual studio it should not have overwritten your config
and you should be good
and when copying you will get notices as to wehtrh to merge or
override and say yes to all and set default to do same

so notice the files now under folder webroot

so that is upgrade deployment

sobekcm.aspx is just a stub the compilation tool creates
2 reasons to precomipile
 1) it prevents code injection, possible by root admin, but if they get
root on your webserver, they could not inject any code to aspx, etc
as it is in a precompiled state

and 2) also quicker and cleaner as no source files hang out on your webserver..

so we precompiled and copied over your webroot,

so now it, webroot, has folders bin and config and those filsw

and the msi installer has it all precompiled a will so I compile it and create the installers..
-
and so now the
rb also asks of sql upgrade scripts

so go back to github repo for sobekm web app under folder SQL
and go there to see folders fo rlast 3 or so previosu versions, and you run the version 4_10_2 ql script vs your database.. go toget to today's version.. on github
and that updates the database..
-
nd it shoo... ld run quick the sql update stuff
and he has uder folder previous versions even older sql update scripts
and he adds sscripts named Mark_2016..etc, the mark*scripts are update scripts..
and then the complete.sql script..
so the mark script is idempotent as it does not change constraints, etc that are alredy there
and at end the db version is already always updated.
and if enw sp is eneded, see it says if object-id.. is not null .. exec..
--
t0905
so now we go back to turn our code of yesgterday and our config and combine them into a plugin
and go to url sobekreposityr.org on left /l/help/tools
ssee under section engien api endpoint plubis.
ad=nd he had written.. and see now onunder git repo.. sobekcm_enginelibrary/endpoints... well he had moved them out
and yesterday he ahd put them ... those two files?
nwo we are in S under sobekCm, object sobekcmm_enbine_biary /endpoints were those two files..
now we make a new
vs fiel enw project and select visual c% an calss library as we jsut maek adll and hightlight create direcgtory for solution on vs 2015 on botom right
and in naem put plugindemo
and we shoudl ahve object sxplroer with small tree on left
and on proejct name it will say outptu type is class library
and now we msut bring in dlls from sobek main core
so once solutio is down, rigt lcick and see pys on projet and make sure project fwork is .ne framework 4.5.. in the projet settings.. (or application settings, on topl left thsi vs widnow ways application..
-
so make sure it is .ent frameork complete, not clietn profie if it gives option
and canput it say under make a volder at same level of the solution near plugindemo and pfodler naem new will be dlls
and now go to get uner sobeckcm/bin folder
and youu probably need sobejcmk core lib, engien library and tools library and copy those to your plugins dll folder, depenidng on what you did in your usings statmesnets, or aslo resourc elibrary isf you used mets reader
or if you only worked with brief item.. these dlls are here.. so mark knows where these objectgs are in his dlls..
probably per the object explorer... tree

now in vs do add reference prorwse and go in wexplorer wehre yoru folders is..
and now he is in vs eiwndow reference manager..
and he uses browse and in ref mgr iwndow-plguin dmeos, go to assemblies, system.web and go to checkbox and hit okey
and so you can get rid of class 1
and in obje exploer, and add, exisitng item and from fiele explorer, git repo FS.. go get your plguinoflder where you put your cs files from yesteray and you should have on rig tin objet explorer your referneces you added, for the two files you will have copied from the web app file space, fiels simpelitemendpoint.cs and simple resutlsendpoint.cs...
ok..
..
t0916...
and so we are working inour new vs projet for plugin demo --  a patchwork of copy pastes of soem fiels fom our 'pluginabble' config and cs fiels we creatd yesterday in the mai wobekcm web app..
OK.
(maybe a script should do all this stuff.. jockeying files between VS solutions... to create a dll of our plugin).
..
rb: his VS orig web app is working because it is stil using
yesterday's so for testing, we should use another namespace so
the config can reference our enw plugin dll assembly, namespace,
and not keep using the wone we set yesterday in our config .
--
now the only otherpart of the pluin you need is yoru config file
so we are in plguindemo/DLL
and now we are now in file explorer
and will crete new folder plugidemo..
and you copy plbuindemo dll, and we put a new folde rwith our dll and our config file, just c:/pguinfolder..
and so he goet ONLY the config file he used yesterday,
and now today all the info is fien, but now ALSO need extension info, but ifyou changed yoru namespace, then you change yoru compeontn Class attributes naems aptly
and now we will change the component Assumbly attributes in tthis sxml file.
-simpleendpointservices.conf is the file name, but in it is xml type info text configuration.
--
so now make sure on the assembly attribute, maek sure the dll name you tive it is t eh same
so on line 21 for ta assembly with soem i anytyou want, attriute 'name' should be the actuall dll name you made today in your plguinonly clas library project..
-

but the ssssembly id must be a unique value across all yoru plguins, not just whithin this config file.. IMPORTANT
so what is in yoru assembbyly id, is what you put in yoru component assembly= attribut value at the bottom.
-
-
so now the plugins doen
and you can see xamples on sourceforge
but generally when we make available on github, y
we usually have aplguin-folder ans source also we maek available to open soruce it, 2 sibling folders at top level of git repo
and the plguin folder should sort of match the extension code- value in your config file, so use the tag extension atrribute code value with your vfolde name of yoru plguin-folder
and then drop thsi in yoru pluibjs folder underneat yoru web.. and then we jsut have to enable it
node: webroot is wwwroot on yoru dev machien there IS an inetput/wwwroot driectory too.. nevrn noticed before.. just like on production.
-
t0930

and now we enable it via the web gui
so login on web sobek
and reset yoru cache and go to the in systewide settings unde .. go there..
and the enable button is still way over on the right..
.. that is go .. down to extensiosn -- you should see yoru plguin listed as an exension

and when you click it you should see your enable or disable button way to the right - he may change that..

and th plugin has a falg that say can never be disabled except by the host admin... so a simpel weeb ueser may not disable some.. mark reseres for himselve, else a colelction mgr may disable and really confuse you... about the csue fo rsoem pernicious bugs..
-
and after you click enable
go to the source files list .. on thsi page
and go to configuration files seelctio reading log and make sure it read it, and you will see thoese.
and then go look at list of engine endpoints and see the urls there
and then put in that url and make sure it works inyour browser..
--
so see and validat you like the xml or json output looks like what you want/need.
-nice.
-could do a plugin for deeply rooted..
- any questions on publishing plugings..

so this proecrue is the easisest, work inside the soekcm core code web app an work i there, and once it is workign rooll it out into a new solution i vs, createt the plgin there with the config, modified as eneded for pugin naems or class naems..
rb is familiar
-
and we can also alow plguins to read its own config info say to have a verbose flag that it can observe and hnor.. mark is noting a need for that..
-
o wrt configuration info.. you can also write your own configuraiton reder within your plugin.. and you can youve yoruw own cofig reader.cs wihtihn your plbugin
and mvs thinks key-value pairs are susually adequate..
-
-rb ahas reset sobek cche, but an iss glitch?, and you add atriute to whwre youdo script tag for js, and it suggested to just hadd a randoe nuber, and i did, but isss seems nasty in that regard..
rb like set expire date or something.. and soemtiems I still need to restart isis, but not a sobek issue..
-
---
c ulder fucntiaonlity and packetes you can look at..
so bulder-
it looks at builder folders and waits for incomign maerial to be loaded
and so we will run builder in visual studio and we will laod bulk resource packages as we do it..
--

so go to syetmwide settings
on left see builder settins
and may not ned to change thee in test, or mayb bulder iis-logs directory if you want uage stats
and mai builder input folder usu alreadyset ok
but o incoming folders you have to set that..
--
t0946
so he needs to ddefine his incomign fodles
and see button does have a button to add a new builder folder
and he does it via web iface here.
so generally you need to create three subfolders, named as you wish, but common
names are inbound, processing, failures

and should usu be empty.

so we create those foldes and put them in the admin/builderfolder/new page's
form..  and can give a descriptive name

and do not need to check archiving, nor copy tiff nor perform checksum
(checksums slow it down)
and check for allow mets with a record status of delete in this folder do
check that

and the last one also check allow resource files in ap..
and do save and done

and now systemwide setting show oru single builder folder under exiting
builder folders on righthand side

and in files go to builde/inbound and copy all i pacakes to his inbound..
going on now.

and we go to visual studio 2012 on his machine...
so he has 110 items there.. copying...

t0950
--
now in VS to run the builder.. now in the builder project in vs..
now in obj explorer, make sure your config file is write ..

go to fs in web app/soekcmbule/bin/debug and folder config and file
sobekcm.config and set the connection string there
-
now in ssms going to his db and
now he is going to inetpub wwroot config and finding his current
sobekcm.config there that the web is using and copying the connection string

mvs and make sure you have subfolders images and kakadu and logs,
and if you installed the builder somewhere you can drag those folders and
copy under your in/deug folder to get thsoe.
-
and now we go to our git repo webapp, bin debug/config and
see there we see ghostcritp_executable. and egingine..
and he edit a nwere once ondig file sobekcm.config with intance tab..

. and he is editing cofnigruationoai-pmh..?

and now to system settings systemwide settings..
just typing url admin/settins/builder/folders in url
now looking at db sobekcm_settings, field
systembase URL.. he will edit

adding application server url is http://localhost and als for system base
urland also for image server network http://lcoalhsot/content

and image server nw is c\inetpub\wwwroto\conent\
and and create wwroot content folder in case it does not do it..
now running builder in a cmd window...
-
now changing static pages locations to ..wwroot\data..
maybe needed.
-
now maybe need to run as administrator.. it helps.. as it writes underneath
wwwroot.. so remember to do that..
-

now restarting the builder
and there are a coulple of invalid packages, eg a subjet id used mutliple
times, that is the mets scheme validation there.. maybe new? for tha
particular validation
now in builder can o to debug mode or see in application window that it is
now indebug mode.. aside..?
now looking under cotnetn (resources netwrok) and see items and keypair
folders appearing.
-
and no derivs needed here
-

t1008- now he finds the items in sobek web searches..
and the images are not shoiwng up
so go to systemwidw setings sytej/server settings to field... .. he gods to an item to see variouimage files
but in thumnail view.. he finds internal server errorrs for soem items..
nand viweall items is showing some images fine in page images viewer
and it looks simlar to streaming pager..except pages are extant in the
resources. for that viewer assumptions

the builde goes yto yoru engine or wbsite and reads this dat from the engine now, ie the sobekcm.cofnig fiel
when soekcm was more static the builder could ake mroe asusmptions,
but as we ush more htings in.. the uildr knows needs to knwo more and if julti instance, the firt inatance of builder will bpull the config info rom that instance, then go to second instance and pull config info form there and run that and dumpso everyminut it goes to that instance ansd says ie me yoru config data.
so now if you go to buider folde it exucted you will see the plubisn folder and thsere will be the pguins enabled on yoru web
the plguin we di is nto imptj
ut ifcustom md plugsin, it sees ifne plguin on the website, ti wil pull thsoe plguins don to eh builder as well
for engine api ntoas ipt ue does thesmae thing
so you tel lthe builder how to read and write md, and so it pulls down those pis automatically and you will notice in your bolder it has pulled them down.
..
and itstil lwroks as ultiintnce see oemm config we see with mciroservides.. tags
now next we look at cusmieing builder by creating a nwe builder module
so a coupel of dif places wher the builder runs..
--
and he has an image of thsi process... maybe on sobekrepostiry.org..
he seeks it..
t1031
and this architecture has been aroune 1.5 years now..
we see ..
the diagrom on asoebekreporog/sobekcm/architecture/builder the image
and on top row it looks and processisn ready submissionpackage ssips and it waits.. and repeats again.. over and over.. (shoul have an arrow wrap around)
and now it misses addl work needed box.. so we add alter
and on botom big box..
and it runs preproces moduls that can do any number of things...
if you had data in emory you wanted to use and load..
eg if you needed a lsit of accessionujbers you might load thm in preprocess and later uload the used accessionides inthe psot process
before it goos to incoming foldrs it looks for addl work nee..
waititernate throuh all incoming folders
and each row is a set of custom optional folde rmodules..
(note it does not build sttic pages here now - a new thing)..
-now lookgin for his vs of his builder project.. we see code
see buile library/moduels in sol ex
and see also FDA folder/class, and so everytime the bilder wkes up it iwll look and see are therer arny digital archive reoports to process.. done once ehwen it waks up.. that is one place you can say you want soething to happen every minut of every day you ould stik there
and now see under modlues are thfolders folder
and cs files theere, one is applbibidRstrictionedmobile.cs
and one cs file says it sees large jpgegs it wants to go to tiffs or jp200s.. it is calle converlt largeJP..
nesxt or w down more is updateNonbibFodlers.cs -it looks when you have bibbvid file attop level of folder, it creates the bib/vid subfoldrs

and nromal agins will apply
and moduels.. validat and classify moduel - here you can chane the way validationhappens..
and final one that runs is middle move agedpackages toprocess max
now borken down, used to be gigantic buh of builder code..
so fer each coflder hit figures which pacages ar ready or valid or if invaid they go to vailur folder
andthis creats lsit of aabialable items across oal lfolders
nvs adwith swolfsoiaon the accession nujber was the folder name, and it looks inthe db and says does this accession number exist, and it reserves mbibvidds, and it also does md stuff, as all he gets is mods files..
and it creats a mets through a proces, and it is done before it becomes a valid bibvvid folder..
- and then it runs many different item level modeles
see bulder code.. but on web firsts see builder builder modeuls under systemwide settins, see section for preprosess moduel see item processing 9but he needs to add folder moduels0)
and he has an item deletion module
and a post process..
and now if incomin item has word delete, it will now go through the delte process.. or you could override this to drop it in a recycle bin..
but if soeone sends a delete bets they problby know what they are doin now.
-and so it takes office fiels..see class convertofficefilestopdf moduel - it conerts office files to pdfs, and see many class names with escriptions...
and eachof these steps is independent not edep on others inthis set of rows..
.
see ocr tiff files and descr for cleanany dirty ocr 9non-unicode freindly)
chek fo rsns in any loaded txt makes emails
creat image dervivs.
and allthese thigns run.. and copy to archvie folder if no folder just quits early.
aso all this stuff is doen for al new and addl work needed stuff
and toward bottom modeul see saveservicesMetsModule..
and saves to db and saves to solr lucent
and.. it does 22esecodn from botom does build static verion for SEO
.. butnow it goes out and hits the seo class.. so see underview items.. itn a repo and pick one, an appendd seo at end of vid or seo?robosoemthing.. he will tell uis later
so the seo iss an actual viewer it is now a managemetn viwerr added for each item, you cannot not hve it..
now he tries to pull up another...  so see in htmo ieeers is SeO and robot is a url segmetn
so append segmetn robot to ta bit .. to see the seo info. it hows the citation, and the complete image, or full text or mroe pages, or if item has downloads the link would be here
so here the builder does not build this pae, but it goes to th web and builds it to serve cuicly as anseo,an it is cached, so tkes 1msec vs 45 msec if nto cached..
this robot is new, not released yet..
and now see ufdc.ufl.edu/rss nto lookgin great
but we also have data feeds see under webroot/data folder (literall webRoot for his machie)
see ufdc.ufl.edu/date/dloc_all.html when ne release comes out, antoehr way to produce a list of links to searhgch engines,and want these pags to e similar to your own pages,
thses arejust lists that link bck to yoru tiems with titels in hrefs, so another way to feed searchengines withiinfo to lik to
now back to coding. dev
now akc to syemwide sttings, and the item deletionmodeule is jsut one moduel.. and se postprocss modules
but the folders are set into folder sets and you can say osme folder uses differetnt set of modules than another folder.. so they put in items in diff folders per item types
the delte iteim module also deletes from solr
-
and so why you might create..
so bulder modeul can observe vide files .. and can copy over to video server.
these lists are maitnaied inteh db
and the olnypost process isuidlagregationbrowsesmoduel - it also builds a site ma.. and other things, and it reallychanged to not build html but nwo goes to the websitd to get it.
so that is the lifecyle of the builder and has spots to stick things.
and mvs may create a new incoming folde module and a new item one.
-
rb asks if thsi process is for incomin folders..
rb has mariage license project withseparate aggrebation wth set terms in the title inthe rprocessig stagge..
rb so ther is no incoing folder process for those..
rb does do bulk loading and projet volunteers do the transcription.. and he has hsi package rep or route go rhtough, and rb asks if can do that as builder module, check the criteria, but mvs but how does it know it needs tobe processed.
- rb so the type in the md fields text, human ocr, and rbputs ready in the title... and at this poitnt. he is satisfied with vounteers wrok, and rbm must approve to make ti live..
rb if i can do a builder module to automatically maek ti go live..
mvs so create a prprocess module..
mvs - are they selected for addl work wehn they edit the mt, and so add a new module that checsk if it is omoduel x, an item module, and if edited by person x.. it can do sepcific things..
-mvs every web editing setst the addl wrok flag..
so we ran into a break.. and will come back at 11:10
and mvs shwos new emailuponsubmit config xmltag to set for a builder module to use.
t1057
-break until t1110
now for ujilde we in vs add another volder moduele
and uner buldr add a folder demo with just iamges files and the name fo the fodler, demo, is the titel
simple
we gen a default mets file and deicde he type
and in sox, wwe sayi fnot abib and no md in it, lets gen s amal lmets file
so look in extant olfder we wil build here
see udne rsobcmcmOcre/builder/moduels are som asttract classes there you have to reference when you take thsi moduele to mov to own plugin
so look unde rbuilr librayrmoduels folders and file udpate nonbibfoflder, and see it extentss abstractFoflderModule
and now we crate a new name for this..?
we will add now a class with name ... customNonBibFolders.cs
ok now get skeleton file
class cuostmnonbibfodles:abstractFolerMoudle and say public class and can ckick to say implemetn abtstrack cals, and it shoves i DoWork method function signatrue
and these classes are non static clases
and you should not add members like provate string some_vaue:,
as all the wrok you do dhouls be in the method Do WOrk and out abo ve it in the clas.. except maybe a counter, as this object will be used to process aevey packeage..
so everything should b in yoru dowork class.
0-
so he grabbs some summary and param  docs strings.
so if liook in the core in sabtract folders.. in core bulder modeul inabstractFolerMoudle.c
see it usew s argumets- new List .. so one argumatn says this is a libary folder and another arg says these are museum .. folders
so you can have diff args com ein
and se public Instancewitrde Settings, and void RelesseResrouces.. you ahve access to, and have some events we can fire off oruselves for errors or regualr processing, and study this cd file
and the dowork method..
so we see fiel updateNonBibFolders.cs and this is similar and uder doWork we have string ssubdirs and its ars is builderoflder and naem incominpackages and deletes.. but really you want to work with builder folder, and you do subdirs - directory.getdirs(buildroflers.inboud folrer
look through them, get naem of folde, see code
is it 10 digits or 16 digits with uscroe to sdetet the format... and he goes through the code of udpatenonbibfolders.cs
and it looks for mets files and xml files and sees wh we have work
and see clean any additional periods in the filenaems first... comment
and this looks at each file and renames
an crate the new objet.. here we create new mets file newiteim.ibInfo.smembers.. whateber
and w lines are like enwItem.Bib_Info.source.code - Arguments[1], so this is interesting...  we can use our argumetns here
now lower we hsave thsi item. for the necesary bidid..
so line 79 we do save new diital resoruce() call, so we save the newbibidi or reserve it so it is not used by anyting else, so here we reserve the bibi vid and lines 1-83 wwe do soem things line 86 save mets, and that is it.
so that is what the ucrrent one does..
-- so this file is in the github repo ubdatebnonbibfolder.cs
--
and see vs tools/extensions and updates and install productivity pwoer tools 2016 (and get 2016 community edition 2015 that is)
and that helps me find soemthing.. when I hove I get the lightlpublb that shows the using that I want.. ti is really great..
- it is very useful and quick to isntall  so ge tit
--
now lookig at line 79 the directory.move. now
now he is inserting in uhis copy cusotnonbibfodler.cs line 69 ..  or 70
newiteim.Bib_Info.soruce.Code ="iUSD";
and gibiinvsource.satmetn ="University of Sobek Digital..."
and newitembiid="AUTO"; he thinks this is special value to maek auto..
back to line 24 or so, so standard we loop through these .. foreach string this SubdDir in subdirs..
and that was sqcuill, quick...
so nothing knows yet about this builde rmoduele, it is jsut a class there, so we have to register it completely though the db
- so go to db in sobekcm builder_modle_et table,
these are diff sets of thigngs tha run.. these roles are ets and so see Stadrd Pre_process modules, standr post proces, incoing item processig, incoming deelte processing.
and moduel tupeid.. mabye 6 is a scheudled task.. nto sure yet
and each can have diff se
so see incomign folder, it is set fo rmoduel id 10, and 10 is standard folder processing, adso 6 typeid is a folder type processing.
so se add moduelset 1id 10..since that is the folder processign set
so so now we sea select * from sobekcm dulder-moduel where moduelsetid-10 and orer by Orde.. and see..  thsese are the idnivudual builder modules that will runfo rthings in moduel set 10
so first slook at moduel sets and ge tmoduel set it and then look at sobekcm bulder-moduels and they arehere in order...
so on far right is enabled and order and arg 1,2,3
and this were see class is set and the class ithe the ful name sobecmbuildelibrayr douels folder.movedagedpackatestoprocessingmoduel,
has ful name, so now we se tours fo rorder 0 to be first processing steps
insert into soeecksm builder modulemoduelsetid,moduedesc,[assembly[, class, enaled, orderso whatever we set there gets passed to use they are varchar max, so can putin there json string and parse in the builder module.. you can put in tons of data in there..
- and use in your library.
so we wneed not set nthsoe inow
vaotnientue sql values 10,'handle nonbib tyep incoing packteswith no md','null (assemlvly, '', and 0 ofor order
and get namespace from the vs file namespace and custom nonbibfolders from vthe vs clas name.. sep by period.
--

and put brackets arround col names assemly enabled, order as they are cotrolled words..
and the row is now in the db
and now under folder builder//
and put under bulder/incoming.. ?
and put bp in our first line of oru DoWork()..
and in config folde... gitrepo/sobemckeweb/ssobeccm bulder.bin/debug.. must add soem folder s , config
or go to program files sobeck builder and grab all subrolders cicldiuig config... kakadu,images.. all thsoe folders and drop them in, and z3950..

and now start.. oops..

so add a breakpoint.. or look in sobekcm builder log
now edeugging i sobmek web app sobekcm builder ebug config.. see the connection string looks right..now try again from ommand line the builder.exe and now it hit our new breakbpoint..
-so now at lines 45+ or so we get al lfilenames, doing a regex.matches line.. and lines 63 + stepping though, etting
so it is steppoing, savign heitem we got auto 0001 so the aothe auto worked..
and now see oru folder incoming.. see the folder was renamed.. and step wo to Save_Mets and then go to s and see oru mets file is in the incoming/auto... bottom level folder, it was added to incoming folder...
and it goes through for another item.
mvs so now be of our proecess we now have these new resoruce pacake that were jsut touchched by our new mdoudle..
on thenow it will run through aging
on latetst version I just moved it into the processing folrder and it vaoids this wait
but nwo usign fs explorer I can jsut drag them into the processing - ther is no wait on them..
nice..
so now it will run again.. and every time it looks at a flolder it runs the package,a dn it processed them and loaded them..
good.
if as rouce code comes in lieke our iUSD, it automatically addes it, so now there is a new aggregation there .. well reset cache first.. and go to gocllectiosn, agg magmg, and se iUSD is now there, with comment added aututomaticaly, and H and N for not enabled and not shown, but added as Instuttion, as it was in the soruce code..
but it tid nto take our isntituton name, so a bug to fix.
so nwo we can see our tiem.. andnow see our citation view shows our basic md that we set in our builder module.. sourc eisntut u of sobek digital tita china reprot for..
resource id chine report fo th eyar
item primary key:10895 and group priamry key 09146..
and we can create our new other one...  like build a log file..
--
now addign class eternalllogbuilderwork, and now we have file externallylogbulderwork.cs and extened abstractSubmissionPackage MOdule
and it has a diff signature
and again we just have to use DowWork and adcetp argumetn Incoming_Digital_Resoruce Resource arg, and it has al lthe item metadata..
so the incoming_digital_resoruces.cs base class shwos al lyour methods, embers, and it shows actionable bulder soruc efolder, whte folder it came from and all the metadata in antoehr element and varioushelper methods, and love mets and save to databse, a lot of helper functios callable by the moduels,e tc.
-
so thats whet we get passed into it
now ading string log_file=...
now how to find wehre the application is running.. google for application startup c% fonsole.. see a link.. so shows itis.. no. another link how can I get the app used syste.reflexction.assembly.getexcutign sassembly90.Codebase

-and put in prefix Path.GetdirectoryName(
so useing that system.rerfl as an argument for that
and add after codebase.re;lace(file://",""
and now... compsoing a log file name...that's all.
--and set log_file_name =exetrnal_logtxt"
and add cod lines..
StreamWriter writer = new Stramwriter(log_fiileName);, wrtier.WriteLIne((Resoruce.bibid ..+ : _ resource.vid _ hand at _ datenow...
and line writer.FLush; writer.close;
and say using(streamwriter in the code
and add append()
and boolean we set as return vaalue (default is returnign voide fro mDoWork..
..
also addign a try catch onthere...

o when fired this wil ubild into the soek builder log talbble
and so we pass th bibvid nd mets type sting(if a delete or not)
and the biblog it we dont really haveimplementd in the guil
and a log is first entered wroing on this bibvidna dathe buildelogid is realting submsgs for this item rpocessing
so in forutrewe one one row for thsi item in builder log and will click sto see all submessages per item.
-
now egiser it with the databse
now it ois on the level of procdsin items, not on folder level
so select * from sobekcm buld roduel se
and it looks like the moduelset 4 hee for incoming item processing is what we need fo rmoduel set id 3
now we see allmoduels in that set in sobeckcm builder oduel table
and we have aboug 30 or so..
o now we choose wehre i this process do we want it to run.. we could do it here after it relads the mets... or now lets just add it to the very begnining,
so we had lowes to f1, so now we add row iwth 0.-
--

so now adign insert itno bulder modele a row fo r this
and mvs said we are luckyhere to not be doing multithreading
but here would be aperfice palce to add ambmer public sttic object lgofile_lock; and that would be static shared by all
and before youusing you add stemt lock(lgofile_lock) and by default it unlocosk at end of thsi clause or block startd by lock(logfile_lock) so a nother thrad would have to stocp when it hits this isf the lock is infoplace. nice feature of vs c#
and now kobject name.. in our insert.. and namespace id lib..librayr oduelsitems.class...
and now we cansdo our insert and make itfire all.. he clicked on the tray ssms symbol. maybe like an execute?
and now  we seelct  .. and update sobeckcmitem set addtiionaworkneeded - treu where itemid -00xx whattever the item id was..
andnow execute an d put inour brakpoint in our externally..bulder..lock.cs..

oops, the repalce no now put it after codeBase). not jsut after codebase.
ok  oops need to put in Path.Compbine(lgo_file_directory,"external_lgotxt");..

now rerun the bilder and look in system admin iems builder statuss tab builder logs and see top 2 lines externally loggin work item is now there.. nice.
--
so we just create two builder moduels, but we can and should make these into plugins.. and one thing we want to do, about the plugins is make them hafe a basic installer fuhction, so to say o enable run this piece of code or sql script.. so when thy hitenale.. so in uilder model but in comment .. you can enable enable modue plugin, and you must run this stmt to modfiy table snow, but i 5.0 it will be provided, so our ocode shoudl have logic to check if th builder module is alrady in the table and then not try to add it, as we did manuallyhere.
mvs and nwo what assumptios can you make.. is it really mdouel set 3? to verify youmight want to do a serach of the code and see which uses the enumeration that is actually integer 3 --
=
so think about what you want to write and you could also do preprocess or post process mdoue as well...
t1204:
see mvs is pushing this out to github as a new projec tor solutio... that we can review---  he is now adding a class library  and callig itadd .. adding to hsi new solutionexternally lgobuilderwork.cs and extecustomnonbibfolders.cs
and so we must also do the insert statemetns to eget it to work for us.
and we will also have to at least add the sobekcm core dll , or other sif want to do more...
-
and also have to include the resrouce object and its sll sobekcm resoruce object.dlland sobekcm tools.dll this is a bit of guess wrok orr reearch
and here.. since we save directly to the db we need the dbagnostic db and resoruc elayer db oebjects dll too
-
sobekcm resoruc database.dll
and another? above..
anow he adds this to github... but no connection just now..
-and now he isadding some sql
declar @moduelset id int;
set @moduelsetid - coalessce(select top  1 moduelsetid from soekcm_builder_inconginf foldrs ;

insertinto sobekcm_builder_Moduel(modulesetid.. etc fom before
values9@moduelsetid)
andnow ...more sql to do theinserts for the builder moduels..
he joins in soekcmmoduelset types tableto get typeid for FOLD ..
and he shcagnes the namspaces to include CodeCamp2017and since thisis a pbuing, we ahave a reall value 'codeCamplpgulderplguin' as sthe assembly value now istead of NULL.. because now ihe is also wrapping this up as a plugin.
now he chnss the exernallylog..cs file naemspace to CodeCcamp2017..

now hehas aproject ode-camp-builder-modues ov vs aproject for his plugin
and he copies from his webapp plugin folder to.. and renames his config file tocondemamep
and chagnes in codecampbulder, cofnig the exensioncode ane name attributes
and chagnes thehis config description tag ana author tag for himself and chagnes assembly to . id to odeacam pulder modue
and then in assembly take chagnes name and id for code camp values..
-- t1221
andnow hs new repo sobekcm-plugin-builde-demo-modules uwned by SobekCM on github.
-

now creating a new itm viwer we hae done..
many rasons to do so, yu may want a sligth variable to a scurrent item veiwer, and a bit mroe complicatd than some other higs.
so we creaet 2 clases often in same file for yoru item viewer
and see exsitin sobekcm library item viewers, and 2 classes in each file include the protyper and the viewer
that relationshipis itnertign
under sobeckitemvier/veiwers see cs files, and see downlaods_itemVieer.cs has 2 clases iwthin it, the prototyper and the viewer

and that is the trend for evey single one of these
and the prototype is the factor
and ther are itemviewr protytpes it is what liks to the item veiwr and also has basic info
and when adital resoruce is loaded only acouple of stirngs coe in
and just a couple of strings and the ui the web will seek those strings and look for a matchigns tring..
and it will seek that string and it links types to items and linsk the items to the possible viwer types and the engine downloads that in the tiem dbasd
and ha tinvofo ispassed to the webs
so in that list of viewrs is the acme viweer
and so it says i got this object form the engien and i will look at each of the viwers an sew wwhich one is alidand it tries each item viwer protyper..
ad the firs time it sohows itit ses th ite viwer prototyper, and itis sort of a signleton class.. ther eis onlyoe prottyper for eac h vier type
and it will apss an item to it and ask the viewr prototyper if it should use this.
and it uses Incude_Viewr() call,
and so each  item gomes . and is it pdf, then it cals includ_viwer for
the prototyper and give s the pdf vier the chance to see the object
an see whether t has ANY pdf in it... and syyes or no, I would be useful for this tim, or part of it..
-a quick loup
and if not to be included, it is removed form eh web for theitem
so that hapens the frst tie it gets the item from the engine
and if you looked at that object in th web you would see many fewer viewers
and the next q is wh the user has access (a normal user or a manager0, so it has method Hass_access that can tell wh the ruser can use this viewr.
and it takes the user_object - so here security can be iplementd for diff viewers..
so assume the user has acces and then tne enxt methd to acall is dd_Menu_items(_ that lists itself on the menu of viewers
and so in db where we can set lables for each view, it adds sto the menu oitem..
the method returns void, but one of the argumetns is an out list of menu items that is gettig build, so not retured, because could hae multiple menu item where it puts itself on 2 places on the menu
so this is all calle .. before they click on the view, it provides th menuoptions apt for that item
so the suer has not clicked on a viewer yet
and finally is iITemViewer Create_Viewer that si only called when they click on the tab fo rthe view for the item that the viewr is created and ..
now we see the viwer object it imiplement iITemviewer
and sonow soem inmplemetned classes
and many itmviewrs do nto driectly implement iITmViewer (pageination item viwer and nopagination item viewr are exampls taht share other common traits, so often the itemviewr does not directly extenet iITemvier, mbut rathe abstractPagiationItemviewr or.. paginationItemviewer...
--so that answers a lot of questions for it.. and it asks are you paged or not, and so the viewr just apsses down sto say I have only 1 page etc or no pages, so net and lat butons are ayut maticalypresented de on page quqntity and number of cureretn page
and so hafe method write_withi_html_head to riteie within the head
and method Add-viwerspeici-oboyd-attriutes can werite into the body tab
and method write-leve-navemenu-section  and method write_main_viweer_section..
thee are the mai things a viwer woud do...
rb: so if has access is false .. the viwer is not preesentted as a men otion..
-
next vg..
creing a new item veiwer
1 create a new itemr viwer protypyer and 2 a new item viwers
and nwo vg crate onfig info
1 start y adding a onfig file in the conf guser suboflder an sue soekm_item_viewers.cofnig as source
so put it under config/user, move it.
so the config file doe snot ref the item vierr, only the item viewr protoypr..
-but that just tells the website it exists
ut we must add it to the database..
so when see syswide sttings it shows a merge of the d dbase and config file
so add to sobekcem item viewer tyeps table
and viwertype should match the code from the config file..
and that link shows how they are comined..
and now we look at systemwide settings for that..and see the ltablee ofviewers..
so see dataset codeob, repots and viewdata, lrows appear sbe they are in the in the sobekcm item vier types table, but not in the config fil.. so class here says nto impelemntd..
-mvs - the key in this table is the viwertyp is the ode in the db is linked into an itemr viwer prototyper... and the row if it has a class shows the class does appear
and the vierdocee say for embedded vdieo it is evidoe, and it telsl when the url has the evideo code in it, it is askign specifically for the shthis viewr.
mvs
so the onfig file is in sobeckcm config default sobekcm_item_viewers.config (but we ove orus to default)
so the itemr veiwr list is important here..
- so the ier ype atteiure shoudl match.. the type name in the sdbase maybe and the iwercode  attrib is the url segment name, and youhave assembly and class and wehtehr enabled or not..
--so we are serious about alwasy adding for only very vfew viers, like the directory viewr, that is one of a fewi that is always added... not even the citation viewer, and it is always added on the wewbinterface side, and the d base says I am alwasy going to add the dierctory..
-
and two types of order, menu order and order
and nit si defined in the db
and view order it only matters what is the lowest numbered view, it is the first view it would show if viewed to it, so ead is 4 and 5 and embedded vierwer is 7, and alowerst numbe..
so if you always want citation view alwasy displayed if no 'citation'segment in the ul, it uses the lowedd number in ie order the one to show sans 'citation' in the url.
-
and the default view again just means if you add a new item to the db,that item gets these views added no matetr where it aem from..
-t1502
so we add to db by addign to sobekcm-tiem_eiwr tyeps table and the TYPE column should match from the confi file
and the last thing is to link items to it
and you can do it programmatically to add to the sobekcmoitem_veier table tro go tot the behavor screen and manually add per item the viewr as an opton
now on soebekrepostiry.org/help/tools he added the sanborn item viewr just a few minutes ago
so now we look at it .. we added a new viwer..
so whenlooking at the sanborn maps, if you look at the page images you will see a visual index on soem items, nicde uf007451/00004 try that
and yu come and click to 4 and it takes you to that page. we wil lrebuild that here
so page images has a 4 opton
so if goi into the direcotry see page folde sectionhas a gif file and a.htm file which is aisimple html map with oshapes with poly shape with coords.. and href.. revidw thisfile
- and it requires at last a give to displaytself, so the idwr prototype will look fo ra gif file.
so on eh elp tools page there is a link to this git repo.
nwo seeing sanborn item_viewr_prototyper.cs with both objects in this one file.. just a habit to keep both in same file,but somehwat hady
so it sts the ViewerTye ad ViwerCode just to be redundant.
and we see method includViewer...
so aone liner seeks. if it exists specifically the filename in tototl that
ends in gif.  -that is the check.
And with sanborn items have this custom combo of a gif and htm file of
this format, and this viewer works precisely for such items..
and other functions are here... eg to support concept that some digital
items are or might be single use but not many in the world
and so Has_Access looks for ip restrictions... but no need for AM4IR.
and so ip restricted indicates
-and pass in the current item current user, current request to the
method add_mey_items... this is simple.
-we use the current request to figure the url to point to the particular
viewer of this item..
mvs here we have an index.. and with page description can have 3 levels so
the index is the same or second level.. so this is a way to bring
out a menu and have option to have a thir tier of menus to go down and over,
so description shows standard view, marc view and metadata and usage
statistics... for the description viewer and so for the page images you have
the dd of these 2 levels.
but line 73 has 2 null args so that is why no dd menu for 'index'

so that the url and this adds it to the manu
and then create viewer method.
now they want to look at the item and return the Sanborn_ItemVier
constructor, so that is the bridge to go from prototype to the iviewer,
So see here line 96 this extends abstractNoPaginationItemViwer (which does implement that interface)
so the itemviewr prototype is hanging around in memory and used over and
over and over, sitting in memory as a singleton... so saves time..
and this is faster, but now the item viewer is only created for the request
that is utilizing it, and a different item viewr is cretd for each request
coming in for that type..
So now sanbornitem viewer can have private readonly string htmlFile and gifFile,
in THIS object can have private data and check the particular gif file
if it exists, as the itemrviewr itself exists independently with it
contructor argument data.
Now we write some stuff  remember the four things that implement
write_( methods 3 of them and Add_viewerSpecific_Body_Attriubutes
AND add main viewer section? is last method rarely used..
add mainviewer section must be ther, but usu does nothing.
and write main viewer section only writes in that section..
it just generates the html...a small amount of code..
from lines 129 for a few lines after that..
and see the htm, and they have to repalce the <%ITEM_LINK%> here too,
a simple replace, and here they stick a j at the end of it...
and the j at the end means it is pointing to jpeg page say 3..
it repalces 'od links' the hrefs in the map as we do not use that mode anymore.
-t1520
- and this is a public viewer.. it is really simple
--
and we did the itme prototyper and the item viewer and now we look at the
config file setup.
Now for the config file.. see sanborn itemveiwer.config file ...
some info is dispalyed and of course the assembly id with id and name..
And next portion of the config is writerviewers section
and using clearall= false' is an old habit of Marks to make sure it
does not clear,but defaults to false anyway so not neede
and itemviewer type is in db and viewercode also matches dbcode or maybe
can be a display value and assembly again is sanbornViewerDll
so that is really simple, the config file... is small, so we did the config
and now we do next hingk:
add it to sobek item viewers table, and the github has an installe script
for that as well.. to insert into our sobekcmtables..
and values sanborn, 1, 0 , 11  - so 1 means it overrides all, and
0 is x and eleven, order is 11...i
and menu order slides the menu option display to the right as it gets bigger.
-
and the last step is link items to new viewer...
one way is through sql and another is going through the edit behaviors screen.
So now mark looks at the sql insertion script...
sp we can add this viewer to ufdc, eh sanborn viewer and add it to the sanborn collectio items
and DO tell MVS, as he wants to see it..
- so that is it..
a lot of stuff, as we create two objectsand have to add it to the db..
and it works..
t1532
-
t1420
and mvs is considering dropping the cache of all items in your digital library-- maybe to save memory.. upon startup.
--
t1435 now on to the item viewer--soon.

TODO: see - what did I add on the server side to protobuf... added an index to some list of items that is serialized... maybe I di not need itany more, as I think I have started to use Session data since then for the streaming image pager viewer.

--now to do the bulk portion -- the bulk changes --

mvs has no slides, but he does have docs fo rit on sobek repositry.orgy
see under dtechnical/developers/createmets and editign exisitng mets...
or .../editign existing mets..

so see that editmets...
see creatign a nenw visual studio solution... setion
and do a console app.. as with plguin solutions, we shoul swith to ..net framewrok 4.5 or can also reference the dlls
and now you only need 2 libbraryres, sobecm ore and sobek cmresrouce object.. th only sobek dlls
and anslo need proobuf0net and 2 other dlls
and do not need engein agnostic alayer dbaccess unless save to the database
so this is like editng hte mets in place and setting the addl wrok to true, is same as if you just drop the mets in indboudn folder..
but do not want ot make chagnes to mets and not set the addl mets flag.. so if you do notit would not go into solr...
-
so create new project demo blukk update sonsole stype app
and in pgram.cs
and mvs tenes to ull out mets an save them and put them in the builder..
so this si devautl console app in clas Program
and static voie Main, nto exciting
and so start this.. and see project DemoBulkUpdate and in file system tnow as we created the project, and crate subdir DLLS sibling to emoPublUpdate folder under vs/projects/
and pull over JIL Protobyf0net from SobekCM...dlls
 and zoom.net and sboeckm_core and sobecm resource object and now to solutiosn add exisitng projets first of demobulk udpate, sobekcm core... and addextign proje tof sobek cm resource obejct and ins oution exploroter edemobulk update, hit references to add, but trye a compile to see what is missing. oops we need sobekcm tools.. and so bwe brign them over.. and add exxitign projec tosbjekcm_tools , and this will lwet us step through..
and try rebuild again..
Engiene AgnsotlicLayerDb access could nto ve found..'hmm,maybe remove sobekcm core.. and ok, that helps
so we need sobecm_tools NOT _Core and now see sobekcsm0resoruc )bobject ahs references with the soozmm.ne
and these also expect to see folder DLLs that is sibling to dmeobulkuptdate , sobekcmtools, sobekcm_x..
so nwo vs is happy with the location of zooment sorlnet protobuf-net
and so we have added the projects thand the referneces
and we need to cick references udner demobulkudpate and now add reff to sobekcmr srouce object and sobekcm tools nowl also listed under thedmeobulkudpate secio of solutio explorer, and the c$ nodes are bloew for the actual soruce
and now in the Main() method can add thinkgs like..
Sobek_Itm newItem - Sobek.. no add usign sobkCm_tiem... Rad_Mets("")
and add to program member private static bool process_exiting_tiem(stirng metsfile)
and oen lien sobkcm_tiem newitem - sobemkcmiteim.readMets(Metsfile):
an that loads and reads into our sobekcm item.. then must look around sobkcmitiem hinsolutione explroer, use yoru intellicense and look around and find newitem.bib_ifno.Mian_title.clearn;
newibiembibinfoommaintiteltitel=
,u ewest greatest titel";
so thsi is an eg of bibliograb chagnes
and can add asection.. add antutro if nonexits
if newiteimbibnfinonaems-count -- =
then newitem.bibn_info.add (and see al lthe intellisene coices) so add_named_entity(""see 4 overlads hin teltillisend, so if give w args, 'mark sullivan", phtoographer", that works
and then have newitem bibinfo .addnote("Digitied yby IMLS gratn fiudnign");
so add biblio chagnes there..
 now isseu how to figure out wher things belwo ng esides doing searhces
anslook in sobekcm web the citation elemetns that appear in the etemplats, and see how the templats handles this field and infrer where theybelong..
or if want to add vracore... go to fiel eexplorer sobeckm library/ciation/elements/impelmetned and see VRA(.cs files and see vra_material_elelemnt.cs and at bottom is wher it adds it. and this iactually a md module and so take this uy.. some code to add a enw vra core material.. it is amd module we have to add and see glovalvar with lightbulk icon tool .. and call is item..getmetadatamoduel(Global.vracore_METADATA_Moduel KEY, ) as next
and coying from vra _naerial_elemetncs.. some  lines..
and now do VraInfo.add_Mateiral("Stone","medium"

so now we hae read the tiem, are makign enw chagnes, adding biblio data, and must search around and find out wehre the data is held and copy paste fromother code
and now add section find the new desitination folder"
and set it to builder/incoming for this example..and so create dir if not exists
ands comemtn si save the mts there
and nweItem.soruc_diretory - desitnaion foler
and newItem.Save_ETS();
and that is it, so toing through it will hae read the mets file and nwo we eidt the item and make chagnes and create dst dir if not her
and save it
and see technical develoeros/editmets
sesee section Usign Default MEtadata COnfiguration
so now NEED these two lines to set dfault values and finalize
and in main progrma nwo put those two lines and then cll your method
and next i main oepn file with list of bib/vids to perform work on, and now read the items and creaete bmets filenamesand then in a while do console.riteline(lie) as  log and writ done.
and thendo consolreeadKey(), and it reads tth text file ..and now after the console writelie
we write splitter = line .split )\t",toCharArray
and bibid=splitter[o]and then create string fo rmets file naem.. and create the mets file naem.
-
thencall our process: process_exitign_item(mets_fiile):
and that's it..
o thi somehow fiture outmets file...
so now chagne to
mets_Ffile - SObekCM_Item.. diretoryform Bib_Vid((see base next),bibid,vid); and base is !"d:\webroot\contet\,
and so this works,
the items edited did get created..
but must go find all the mets/mods tags, entitties that can be created..scanning the source code and or templates in sobekcm source code for example
and you would probably also set the addl work needed flag if you call SAVE_METS itself...(maybe because safe mets puts it in the resources foler an the builder still should go run SOLR indexing an other stuff?)
so we would add a few more things to this to set the addl work needed flag,
or do what gets done when it is set...
so he creates or updats project demobulkupdate
and we ended up not using the core, SObekCM_Core, so delete from fs
folder..but will need more.. from full sobek webapp we need the engine
agnositclayerdbacces and sobeckcm resource datbase, so copied those
into fs siblings to DLLs and others in this VS demobulkupdate project file system space using windows file explorer
so we will set the db addl work needed flag here.
and now just need newItem.Save_METS() at bottom of our method
so now add existing - to project the resorue database that we copied via windows explorer
so here we are going directly to save the files and bypass the builder it seems.
and in main(), we also need to set the db connection sting as third line,
or first under the second Resource ObjectSettigns.MetdataConfig.Finalize_meta...
line -- sobekcm_item_Database.connection_String = "" whatever.
and after item.save-mets
have a-sobekcm_itemDatabase.update_addtional_work_needed_flag(), b-(ItemID, true)
but need to lookup the item id before this..
and so can call Get_ItemID(newitem.bibID, newiteim.VIT).. to get int itemid..

so thats how you would do it if you were doing it yourself.. that is
if NOT copying a file to the incoming inbound folder, but you did
do a save_mets, but you neded now to set the addl work neede flag
yourself to TELL the builder the mets changed so I guess it can call
SOLR or other stuff or reveiw..
ss the mets..

so dto use default md config.. you would make a cll to the engine and ask
for the md config forr yoursintance and you would nedd puisn for
your med, and if you something unique wtih your med you need to pull it
in at beginning here.. maye per ...
??? but not terribly complicated code.
so we have not actually called any api

now we add the core library to our demobuuildupdate.sh project
-end today
 demobulupdat
and add a score project and add access and get sobejcm_cor we addand how we can put at first linee of Main()
sobekCM.Core.Microsservicesclient??.. lookingfof ri
now.. now lets add the sobekcm engine library and to exiting project..
-
t1638 mvs note: if a config file in a users diretory, it can be used to just augment what is in default config file of same name... and if it happens to redefine a viewer, the users viewer definition will override it. So the last write would win.
Optionally in the user config file can have a tag <ClearAll x = true> that would clear the default viewers if any prsent in the default config file.
------------------------------

end 20170425 t1732
-end today

20170426 wednesday code camp start
t0820
mvs - item viewer was changed and args for results viewer is different
for rb because add menu itms used lwoercase i..

mvs did put out new sobekcm version this morning, to go out to github release
this weekend ...
with minor change to argument object passed or used wrt result viewers.
--
today from 830 to 11am we customize the results display through plugins
and 11-1230 we do ' adding new custom metadata'
then camp closing at 12:30..
good..
t0825---
OK, here is our day's schedule, and we look at results display
through plguins... pull this down.. to long to show how they work..
and some pretty short ones here.
and then we do custom metadata

and then examples of plugins and what to do with them.. but mvs
is making a helper..-- and we can go for lunch
--so now for results display..
and now he is pulling newest plugin portion of code
and see the webapp

solution sobeckm_library is the main object then results viwers
and the new file he has is Custom_Thumbnail _ResultsViewer.cs
And there is an iface for the results veiwer.. hence the lowercase i prefix
in the var name.
and these are specific to current requests..
so the way we do results is there are two objects, one is ResultsStats
that do not change dep on page you are on, and the other is PagedResults
and so year the iSearch_Title_Result is list of 20 results to show

and stats have stat hits and the facets.. that appear on the left
as you page through results they should not change
and we pull up the facets in a cache for 5 minutes only,
the hardest part to get results to ..
and may be minor changes as we go to solr but will not change too much
and the facets are much quicker in solr
and these two objects combine as you search/browse
and object RequestSpecificValues i was alwasys aka the RequestCache,
a concept we created in sobek, not  system.web thing..
and we can look at that.. we started using this.. to hold current
mode, paged_results, html skin, etc.. see its definition..
and back to resutls viewer in resultsviewer.css main file source file
and one method is add_html that ads html to a placeholder on the
results screen, and that is likely to change
bec.. so we add to a placeholder instead of writing directly to a
response string, and we udtilize that now onlyon the tree views
with items for multiple items, but it does not work well, and it
complains when you go back and sys cannot
reshow page cannot pull down ldat
and we will switch the approach awasy from placeholders to direct
string writing in repsonse string
and so it just .. now, makes a literal
and later instead of adding a literal to a placelhodelr,
it will just be a responseStream writline,
We are gettign rid of placeholders, but it makes it complex to
add complex asp.net controls into it, but still probably worthwhile to ditch
the placeholder approach.
So all they results viewers do is Add_Html right there -- see code
And there are some other objects available in this code/viewers code, no bigggies
and so the abstract class has stuff to help paging through the results
and when all done...
well thumbnail results viewer is a good base
see thumbnail-results viewer deps on base and then
implements the iface and its only method is just add_html
and so you make sure there are actual results before you do much
And we just look through results here and we do not worry about facets here,
and just fill out main part of results screen.
-so see.. we only fill the results the 20 items
and the results html subrwriter fills the facets on left and top part,
and thumbnail viewer is simple table.
-t0835 rb has a fix to facets line breaks issue,
see digital.lib.usf.edu digital.lib.usf.edu/cape-canaveral-3d
and browse collection and see..
the the fourth row third column breaks the word etfechor? or delector? hard to see..
mvs will look at it

TOPIC: Thumbnail results viewer
so back to thumbnail resultsviwer.
and utlimately you loop through all results, and see iSearch_TitleResult,
is an interface, and the reason is,
the thumbnail view only shows one thumbnail per title..
and so within the title result you have items..
and your title result has a list of items underneath it and you
can get .. and you use that to build a thumbnail link..
and he describes the links in the thumbnail,
and see firstitemResult.MainThumbnail is one data member with
items-specific info... ok
So the hidden stuff in the code he says, it is the region is the
hover-over google tip
he calls a region to be hidden
And in there you have opac-number and you use md labels and loop
through all the md
rb: i thought the body of results was from a query stored in the database..
rb: wasn't the body that shows in uin the results a query..
mvs yes see resultsstat.metadata_labels.count that is a list of the md labels,
from the db?
Because when you do the search it returns results for the SQL that is in
that collection.
So it is stored here line 222 for in... resultstats.metadata_labels.count
Now we see the result item see core results/ (in sox), get foreach_item_result.cs
or searchitemResults...?
wait.. now see .. ok see there around line 92
now... see under realtitle? resultsItemInfo.s.. no
see results titelinfo.cs..? looking
see line 41 resulttiele_Descritpive term now

now back to search_title_result.cs
line 49 is just a string metadata_display_values, but we do not know what we
will get back from a sql search
(mvs uses sql server 2016)
and it runs dynamic search based on sql in the database for an aggertation,
column browse_results_disply_sql is the field in sobekcm-item_aggergation table

And see for every aggregation is this chunk of sql.. so that is what
runs to return the md related to the titles per item - a handy field
so the itemtable is the table with the items returns in the search..

so see one..  it is a select
so we figure out what we want to show when constructing this sql
And we .. you can change these, this is the default one,
and see segment [publisher.display] as publisher
(note 'as publisher' is missing now.
So you can put in the 'as x' to show
what the label displayed as a label in the output.
So sql says here in this sql you define what elements are returned and what
the labels are.. so for source institution it shows source space
institution so underbars are deleted too before display labels are shown
mvs we should just trim it at the dod to fix these, he may change that..
So that is how to determine which fields are returned eg like accession number
(We are looking at the default browse_results sql in a tab of the SSMS tool)
Here is what you add.. and what i

For am4ir: user defined columns  maybe good to keep manuscript post embargo start date?

And so the metdata basic search table has every md value (from the
md mets resoure files) that you may be looking for..?

So see all the metadata_basic_search column names that correspond to basic metadata..
and many are user defined, so you can grab and create your own
empty fields they are userdefined01 nvarhchar(max)

and see the mapping table to see what is mapped to each of those columns,
so see table sobkecm_metadata_types table..
and so when you save data to db that you want searchable you pass in pairs..
So when it finds a value that you give it that it can't locate,
So say we are saving temporaral year and it will find..
So if it seeks EAD name.. and it the display term is associate
with userdefined columns..

So going back, if we wanted to show EAD NAME in search results
then in our browser display we would say 's.UserDefined02 as EAD_Name'
and there is an all aggregation..

All the searching portion is per item la
mvs - and you can handle this here.. these ARE per item values, and
you would not touch the md types table, but we would write custom md
saving values to the db and next time you see in the db.. as manuscript
and when you save something it goes in this column..
-so when you do a search or browse you would get that is ...
so you would normally just edit the top of the sample default browse results sql,
usually not to bottom  parts, the from or where clause parts of a
browse_results_diplay sql..
--
but no guid iface..
--
so that is where it gets the values for the display the metadata display values
and so all the results viewers are  a bit different.

and you have the table, brief, thumbnail results, the three required and others..
like we see in this list..of cs files under the SOX object resultsviewers

And they all act very similar, one method that fills up central part
and NOW (as of 2 weeks ago in preparation - in official release soon)
we have a factory that we use as of 2 weeks ago in new code, that
creates the results viewer
so now under sox sobekcm_library under html, we have html subwriters,
and for each main mode there is  an html subwriter that handles paging
through results and factets, used borw bowring
so paged results subrwriter is asked to gen results viewer from the factory..
and the results mode is used by reuslts factory to create your results viewer
and it will look similar to these (see some new code.cx for the factory?)
in that we request things like class and assembly, switch (config.Class)..
so see file resultsviewer_factory.cs
and it returns well established ones, so not one of the std ones.
so it was not a std one, so we can figure out from the switche cases,
see lines 78 70 and it gets the type and returns, casts it to the results viewer
so it looks at current assembly and creates the class
. and this morning he added traderouts .. see lines 93 or so
and finally if an assembly was indicated see lines 108
assembly dllAssembley=null
and we go on to build path and load the assembly.and it builds
the type and gets the return object the same way: using activator.createinstance
and it assigns values again and returns
so the factory is pretty simple as well.
So he does not want to use reflection all lthe time so we have cases..
so we load the assembly.
And this mornign he created custom thumbnail results viewer, and
similar to old results viewer
except line 72 fie custom thumbnails results viewer,
we see if coll -- 2 so now we have displayed for us 2 columns of thumbnails
instead of 4
so he created this viwer, and loaded the code and modified in a
few places and it is just haning out here
and we can go into the config user folder,
so it is not yet a pluin so do not yet need exension info,
so i have tha I a unloading this or loading this viewrr
line 18 of file sobekcm,results viewers.config
Now ac to see old thumbnail viewer in file sobekcm.result..viewers.conf in
the default area
but now look at our new one.. line 18 because it is same TYPE THUMBNAIL
it will override the existing one.
and our label we did change
this is in the user directory for this when we create our new config file
so it will overide the default
and so the label returns on menu and description is what appear when you hover over...
so now we can just run it...
And will sy viewer items, and see now menu tab says THUMBIES,
and click it nad see the two thumbnails wide viewer..
-curently now t a reat way.. to?
if want to get rid of thumbnails
one incompleted change will be complete with rollout
is every agg has a config file and with that config file it has info
about which file is atached to that aggregation..
so we will pull the item out of the db..?
we do have tables for that, see latest script.
it will add to each table, and each will have lines to resutls views..
and it will be fixed..
and so now which result views are linked to each aggregation will be in
the db.. for a good reason I forgot..
So before if you added a new viewer you would have had to add it to
each config file, but now you can just do it in the db..
But if you replace one in total with TYPE you need to not re-state
aggregation restuls views.. as you will override an extant viwer
type that way, simple.
and he will probably not commit this to github.. ?
but he did commit a new  custom thunbmail..
and you will see it under config/samples is a config file for it
(as gitignore does not take users folder)
so we can just copy it from sample folder and paste to users folder..

--so i would email to mvs a javascript for elsevier to make it publicly available, as that jscript is not in github (some ufdc images are like that too.)
and we can come up with an arbitrary versioning.. and we can ..
--
So I can email to mvs the js for the elsevier CORS stuff..
and he would put it up, our js for am4ir/elsevier
--now the cdn is fast as it can support parallel dl of the requests,
and our webbsckin does reference the cdn. So if it needs 12 js files
it can dl 6 from one cdn node and 6 from another in parallel to speed
up the downloading.

and we just use cloud slayer, a free version as well, we can jsut maek awebsdite, they have one cdn.soekrespositry nd register wwth cloud plaeyr or cloudflare, and they come to our server and scrape eery so often..
 it is free..
- that is free, and good.
-
so do not need to chagne bottom part of the aggreg. the browse ql and you can add to from a settign table and to a left outer join to the settings table, and you could pull one row from the tiem table i n this query.. thsi browse sql on the screen.
-so maybe we can look at another way. -
it is transient environmental data, or add a column to item behaviors, .. or you can do it as spatial kml..
maybe mvs will play around with it slightly..
and so he will thnk of alt ideas to not coopt spatial kml field..
-for later, but we can use for now...
-- rb - So when we start doing thigns we do it in our branch...
-idea builder module put in hash value per md item and check it..
-idea builder module check validity of md and report more detailed error in failures error messages/warnings (unknown md tag - skipped-ignored)
-check out the bibid assignemer they now use for accesssion number in their builder module,maybe can add LS... or just go ahead with our/UF own server to feed the builder, a governor.
a dietician.
-

-

t1020 creating
now topic is creating .. no adding custom metadata fields..
discussion
so a few steps
1 - mets section reader/writer
2 metadata module
3 breif item mapper
4 citation dispaly
5 resutl display
6 template elemetns
7 configuration changes
md moduel sores data in memory
brief item mapper maps beween mets and brief ietem mapper - it is also in enginthlike mets section, and its output is sent to the web
and citation dispaly shows it wil display
and resutls display  is antoehr set of md
and template elemetns are online to let them edit the md
and clast cofnig changes that go along with all of that

now met sectionreadder/writer
1 usu it is admdSec rob biliogrphic or amdsec for admin section, and it can tag into multiple levels, at top level to desrvie overall, ro division level to individ divsiions or at lapage level stoo

one eg of dmdsec at page level is how we did aerials as coorinate are at individ page leel
and it writes intot soekcmmets file and reads from it
and thrids should use a schema, existing if possible - so can google around for a scheam that will be i nthe et file, and seek as cheam or crete one so builder or it cn validate for it
and lst the briddge x moves dat from met file into cusotm md module in the sobekcm item object - ahd tha is red from the file into emory
and so eg fo rdmd ection:arader/writer
book includedmdsec, read0)dmeec and write-dmdec methods an scheam pys is shwer you delcalrre what cheas shoudl b used
and incldue_dmsec -sayins looking at arg sobekcm_item should i write any dat inot the mets file, and it will say no if no data
and boold read_dmesec reads with xmlrader from the sobekcmitm
and a rite_dmsec ues textwrtier to write from arg of sobekcm_item
so fro mconfiguration you hwo telit how it tagged to certain dmd sec in the mets
nad it stells it when to send this dndsec to reder writer
nwo metadta modeul - is read from soekcm
tje reader writer creeats the bokecmdm ...
so read dmdsec if it finds good data, it assures the md module is asttached to the tiem at the apt loc
and it
md moduel cretes and populates .
and everyingin in the imd iface there isa strnig moduel name
see lsit <keyvalueparis<string,string?? metdata_werh terms, used wehn sacing othe dbas,e like tiel creater createor cretorname
so itis stii.. or keyvalue paris of term and value apris
and they can be sored in solr tha way or db that way, a way to pass out a flatned kv apri structure all data to be stored
or if your data ismroe comple,and you cannot flatien it well,and 2 other methdos we can use thatare rarelyused, only for geographic stuff now
methods retireve additlininforform datab ans save addl info to databae()
so that is yoru own part
so you have your own pys of course, so if make own poscatcard dat.. and to extenett hi iface you must include thisl keyvalue par
so now the suttff is read into the ite in the md module and we do not nec pass it betweeen ite and weba
and what we pass in the breifiteiminfo object which also is a flattened sort of object
so it has name and about 10 or more pys
so you map it into brief item mapper whose goal is to show to user online,
so it flattens citation info almost into what you see on the display..
so md is pushed into creator diplay field, so author tag is lost
but it can be passed ch and forth and brief item maper has only 1 method to
implement: maptobriefitem(sobekcm_item, out to briefiteminfo)
START TOPIC CITATIO DISPLAY
now citation display, and now we  are on citation display topic
now you can actualy search it bec if you saved it once.. all your custom md is
in the d, appears a new field linked to that collection, and will appear in
your advanced field down you can search, and it already has the search code,
and that is working now
but now you need to show the data to the user
and the citation display is mostly a config file chage, and optionally you
can create own custom citation section writers..
to change the way things appear in the citation on the scren, but our example
does not have this
and results display is repeat of what we looked at

TOPIC EXAMPLE USER DEFINED
so you need to update the browser_results-display sql column like user defined o1 and o2
and so nice here is you need not touch the db in this process
because first item db gets this list key-valeu pair metadta_search-items
it just grabs the next underlined column 01, etc
by default we iss a couple of columns in sobekcm keta data basic erh ble,
and if see in the md types table the first two columns are snagged
but/by something so you can see how it would behave
START TOPIC TEMPLATE ELEMENTS
now topic template elements - how to let people change the elts
now template elts,
you need to create elt objects for each new md field you created , about 9 here
so you need to extend the abstract_element class,
and when you eid tmd you see.. the control
and this does the writing and stores the data back to the sokekcm  item
so you can extend the abstract element or exiting implementation,
9 exist eg checkbox_element , multipletextbox,element,
and any of these can be made repeatable
or you can go back to abstract element class and implement somethng else
like richard b's doi lookup element
generally you create one of these for each new field you are adding..
so see also others like textrob comboxbox element sulike subject term
and subject authority good elt for that..

so until the helper class comes out, we use this
START TOPIC CONFIGURATION CHANGE
and finally we have configuration change topic
metadata config chagnes: regiser new mets section readier/weriter,
and add tho the deault writing profile
an brief item mapper
and other missed
and configuration change.
also citaiton change - add new citation section with new data and
regiwewt each new citattion element control so you can add it to template,
so must add to template file as well so it shows up to be edited.
-
so a good number of config changes.. so that's the bulk of all
the different stuff we have to do

START TOPIC STEP THROUGH RICHARDS POSTCARD EXAMPLE
now we step through richard's postcard example:
now in vs, and thi isa a plguin, see hsi pluin, see obje tpsotcard postcardcore_info.cs object
and see lines 41 or so some individula fields. down through line192or mroe...
rb was given speific guildelines.. and if it appears strange it ws guidance he was given
so we wanted compound subjet
and see line 197 moduel name is potcard core
line 204 puts in list of key value paris, and see line 208 the string that is saved in the db and it grabs nex user defined column and line 240 has nice structure with subejcttopic, perspective an subject name
and we hae a nice subject object ith 3 fields that we flatten to get into the db
so this is line 266 md module
and we can putt other stuf fin there see utitlieis fiel psotcrdcore_ogging.cs
and lie 274 .. if subject is interesting and wantto let user do a earchwhile they ar editign see lines 274 to save stuff to addl table in the dbase so can add nicer functioaity if you want
so now to file postcardcore_.. other last rhere files, mroe comples objects tha are par tof thsi
and now to ouroutlie, and see threader writer, and it implemltn sine 11 the ipackege_dmdse_eraderwriter
so it is not a placeholeronly, or it coule be idivision_dmdsec.. ro iage, but ipackage _dmdsec means top level of hierarchy
so line 15 - include dmdssec see it goes to ge the line 19 pulls out postcardinfo
and line 21 cehs null and says do not return a dmdsec fo rtis
and whithout this each odule with ddec would put empty emdsec tag apirs in yor file
an if it is there, is still may nto have tate.. so only at lines 35-36 does it return true
now see line 41 read_dmdSec perortion
we ar passed an xmlreader that is rding the xmets fil, and line 45 if already , ge the postcardInfo
and if not line 47 we create one
now in meets file we have seen point to show this reader rwriter needs to be fired up.. so we can assume ther will be daa and can add it  write away..
so look at esat code for this or mods reader writer
lines 56 we do a do while and goloop through and look at each one.
and the bulk of wha we do is line 78 we taek the termnanme, read its value, and line 89 we add it into the moduel
and so see line 80 we maek sure it has  .. so this is our bridge from the file to the md moduel
and repition down . and lien 155 is mroe complex oboject with attributes andthings like that..
and here we look fo rattriutes.. but not much variety.. simple to write, but nontrivieal number of lines... thouhthe concepts ar trivial
and so line 290  the reader takes the whole dmd setion nd passes it to the reader.. at line 288 whiel (Input_XmlReder.Red90); it just hands it out as it goes
and we kipped schema topic,but see lines 295 if you have a schema locaiton.. and ine 306 shows the schema name space and if dmdsec is required..
so 309 allows mets package to not be overlaoded and to include only schemas that have data in this mets file
and line 337 is our write dmdsec
so ultimaely we write to a text stream,
so not a new otuptut-stram, wo so we are passed it as an arg.. and this just asdds the little section for
that dmd sec and the dwriter just goes onthe caller, so here we just write into a building stream
so you could build an xml document and have it go to string as an alter, but here, eg 377-378 just write
to str if have the data and that is it
That is what a reader writer does, reading into a sobekcm item or string to the mets file from a sobekcm item..
so .. that is it.
And much of this is preexitsting, not just for plugins..

But there is vra core mets section reader writer, and a vra md module, as not part of our core
our core is mods type data ind sobekcm type dt..
so the top 3? t of he topcks for adding custom metadta fields..
t1050
so see sobeckcm_resource object, metada-modules/EAD in sox are the misc md modules..
and see rights md_info.cs is an admin setion, and we have a good nine examples
to look at and see mets sec readerwriters
et iDivision_dmdSec_ReaderWriter.cs and 20 or so thers..

-these are all examples of mets section md writers
and moving on to brief item mapeprs they are in sox in the engine the mappers
so all get mapped from sobekcm item to briefiem field not just custom md fields
and many examples here..
and so here are briefitem mapper objects
and you can create a new mapper called mynames that maps the name info differently,
so we can pick and choose them and they are all in configuration file
see languages_briefitemmapper.cs
and all that they have see map to briefitem method line 21
and so here arge original is mapped to new briefitem info..
and line 24 if languge we iterate through them.. you see a lot..
and of sio foreach we iterate through each language, and this has text but
others may have code and line 31 we try to figure out code from the text
so here we say if it is just a code.
line 34 we just add to the brief item language is the term and a language text is the value.
so back to the postcard_briefitemmapper in rb project
and see lines 33 is one case..
and so in his postcard itemmapepr
line 15 we get the item out
otherwise it is same as existing ones, and in lines 48+ we see..
emulate this one, this is how to do it.
so see also other_URL_BriefIemMapper.cs in web project
and here lien 27 we see New.Add_DecriptionOtherItem", mainEntry
and it also returns briefitem_Desc_termValue
and here you can assign several other fields if you want you can assign
in line 14 the value, and get urls, see briefeietndesctermvalue.cs
and ine 40 or so subterm
and line 52 searchterm - if you want it to be linkable to click wi a
citation../ now this one is a godoeg,
the creators name  you may want to the creator display mark
twain some years, but when they click it you may want them to
only search the name mark twain instead of the display value
so briefitem_dekTerm valeu.cs - brief item mapper could be more complex,
but need not be
and in this case line 27 in other_URL_Breif atiem mapper.cs we added a term.and line 31 woe could add thsi as will so in sobekcm item other display labe might beoriginaly ead, so map to subterm to retain that 'origianl ead' if youw ant
so it can be more omplex but need not be
so in psotcard hsi briefietm mapper..
so review what we covered
and we will cover itation display when configuration chagnes
so what is left is oru template ellemtns - how you can enter it oneline
see under psotcare elemetn nobejct 9 or so cs
files
rb; amek sure your elt names ar unique, do not use 'forat' as he did, it shows ups elsewhere
mvs  - problby think about putting postardcore in front of all of them..
rb you  -it ishard to show or discove rif you are unique
mvs so put psostcardcore in front of all of hsoe clas names
mvs but it is unique intohetter ways, it has own namespace and on dlls, bu the application should nto trip up, wbut we as template authros may get confuse.
noew see era_element.c line 15 can extetn bas
now on to bgo back to .. only wrt guile
obecm enline librr/cittin/elements/bsetypes in sox, and see here 9 or so elemlentn base toyeps widgets
and under impelmetned-emenlments objct see tens or dozens, add for each md item youwant to edit, they hae 5 creator_x elemetn.cs implementations
so you may have crete elemetn with simpleetxt bosx,
or cretor comples elt with name and hsi ddlist name of a role
or elet creator ffixedrole - nd youcan give only fixed role.
and creator notes may be cretro and fiels
so you can choose which cretor type
you want to use, so ther ar many
aslso see cox objec tnonstanard leemtns, see name_form_element.cs a fith way to crete, as you start tyoing this form pops up,.. good to show and oedtoit creator ne
in an extant item mostly
so bulk of non-stander elemetns ar mformes that pop up at you
or the serial heirarcy paenal oe haccepts iteger and oea txbtbo. ther ar a lot of hee by ddefault
and this is he ost edious part of the etediso
so we hafe to cret an elt fo reach one of htese
so see era_elelment.s in postacrd core
so line 22 can define not repeatable or also can define in config file
and a couple of rquird methods at lines 25,31, 53
3 1 lien 431 is render tmeplatehtml it draws the htl fo rthis item, and you will also put out the exiting md aluesfo rthem to edit
thsi daraws the orignal dication dat to the response hwn it comes back fo rht uer to edit
and ssee line 43 we have to get the data gain, and if not null we dispay the vale line 47 and we use line 50 render_helper so the base class writes the htl fo rus
and afer they type in soe data or not, ast soem pot the user hits submit and it comes back to the tmeplate object. and so i will pas to this
line 25 firs tprepear for save as they hit sav andline 53 save to bib
w two step procsss as if it is a list ia my clearn outthe lsit and with psotcrd info line 28 there is ntohin to do, no preparion fo rsaving her
and line 53 we sav_to_bib
and it looks at allkeys line 57 of curent request form
and looks fo rits on name,a dnlooks to the form to see the boes that it wrong dso gethe alu out lien 73
and see ifthere was length to the value we assign itand ifnot length to it line 94, we assign that, wthithout this else it would be posoible to cleer out if user dleted data and hti save, that is how we get to thsi else
and so that is how to extent preexiting elt liene 15 base extends simpeltetbox_elment
so those ar eh template elmetns, one fo the ore tedious parts
so if making only 1 ne field not bad, but here we had to do 7 or 8 of hese things
and now look at he configuration file.. it siintersting. ckind of like a dmeo of what we want to do ,..
lookund psotcar dcore.xml in the github repo
so line 8 etension is postard core with nane and lines 10-18 we hav e admininfo and rewe link
and lin25 26 is hypothethical stuff so we can hae a schea and hope to alwasy include it..to add css this way.. new css, not ofewrtiting exitng..
lines 32-36 new ideas hwo to add or remove sttigns during instlal ,and in here weill add way to run sql script during instlal
and in uninsatall section, mayebe away to run cshartp code and sql scripts in both instal land uininstall
linds 47-53 hav e configuration.. info to prvodde ome info in config you can read.. a way to show this dml could be easily accessible to yoru plugin. or you could creteyour won config files na readersto invent your own stuff
and lines 58+ configurtion reads keyvalue pairs that can be read and you can change inyourconfig, but we are not usig nthose yet, but preapring
noe line 71 engine  we are not yet usign. but will soon.. a psotard services class..
and line 84 metadata portion.. what do we do
hwer we eregistr rne rmests eaer writer and add it to the provile
so line 84 we add it with id lael,namespace and assembly and class iand isacive and section isdmdsec,
so when it redsthe.. skip all that..
no that is how we assign th reader writer so the websitedknow aout this
so the mdtype and othermdtype ar present in the pemets file, see each mets file has those..
so here is the dmdsec and each ETS:dmdSec has id and hte mWrap hs MDTYPE, and ould have OTHERMDTYPE attriut here soem have it fo some usef mets file..
and same with amd sec, hcan have mdtype and othermdtype attribs
so we know thoe ar package level dmd ection mets:div dmd="Dm11 DS2" and so they are tied to highest lievel  so see hwo that works
so the mapping part of the confi fiel ays when you rad the ets file and seems mdtype of therh oand othermdtype of psotcardcore, then use this writer, at lie 88 of the psocardore.xm onfig file
and iseafualt attri eans use this, so do use this hen you hitthat in the mets
and lines 93 we ad itto the defatul provild to read writerin line 96
so bydefault when saing a mets file it will invoke this reader writer.. so you wcould hae diferent writing provdies too
so this says when you ar eading use this mapoing to oaluch at lie 88 and line 96 when writing try to sue it
and next lthing lins 105 is oregiser mapping sets, eg line 106 we hae internal, standar,cittion and we registister this in youw own mapping sed IDS and can invent your own mapoin gset IDs, and can vary what they do, so do register it
and lines 119 you register syour citaion info to let yoru citation info know about these fields
so the cition is wrtiten by the brief ietem so metadtTer m youwant to match what you cite in your briefitem mapper. so your metadta trm may use a postcard prefix/
so shtis fi
this says we add a new fieldset for id postcard and these are the
fields that will be there.
--t1119
go see a citation, and each region of 4 or five on left margin is the
fieldset name goes there
so order=append is an option and you can set what order you want it to appear.
-
so now go to lines 143 templateconfig - registering the template elements
ad your type see line 151 subjec subtype postcard, and in your template you
would have this, and when discovered, it will create an instance of this class,
how it maps form template xml.. we are making web aware of elts that exist by
cretating them here
but still have to go to dloc template and add those fields to add to the template.
-
so all these things appear in our sys admin setting sw sysetmwide settings as well
under md config, md search fields, they will show up here once you have data here
and your mets reader/writer will show up in that list
and your writing profiles will show up in those lists
and also in ui configuration template elements as well, you would
see your type, subtype and class..
and it sil who up in your deault citation sets under admin/settings/ui/citation
ui configuration citation viewer

and now mvs task is to create a helper.. and the helper cannot do
it all, but it can.. we should say to it we want to add an object that
is a string or a list of strings, and it would generate most of this for us
but it will not generate your ncie complex objects like postmarks sent,
postmarks received objects, and it can generate quit a bit, especially
for simpel custom metadata it would do maybe 70% of the work
and it would be windowss form to generate this helper output files..
or maybe one day a web form..
rb: or maybe a vs plguin, but mvs says windows form will generate .cs
file set to put into your vs project
and the biggest thing is to give the field name and the type of field it is..
t1141 - ending...

--end today
